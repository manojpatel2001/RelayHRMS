
  
    <style>

    /* Session Timer Modal Styles - Specific and Won't Affect Other Modals */

    /* Use specific backdrop for session timer only */
    #modalBackdrop {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 9998;
        display: none;
        animation: sessionModalBackdropFadeIn 0.3s ease-out forwards;
    }

        #modalBackdrop.show {
            display: block;
        }

    /* Session Timer Modal - Specific ID selector */
    #sessionModal {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        border-radius: 20px;
        padding: 2rem 1.5rem;
        width: 380px;
        max-width: 90vw;
        text-align: center;
        color: #333;
        box-shadow: 0 25px 80px rgba(0, 0, 0, 0.3);
        z-index: 9999;
        display: none;
        border: 2px solid #667eea;
    }

        #sessionModal.show {
            display: block;
            animation: sessionModalSlideIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        #sessionModal.fadeOut {
            animation: sessionModalFadeOut 0.3s ease-out forwards;
        }

        /* Session Timer Modal Icon - Specific to session modal */
        #sessionModal .timer-modal-icon {
            width: 70px;
            height: 70px;
            margin: 0 auto 1.5rem;
            background: linear-gradient(135deg, #ff6b6b, #ffd93d);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            animation: sessionIconPulse 2s infinite;
        }

        /* Session Timer Modal Typography - Specific selectors */
        #sessionModal h2 {
            font-size: 1.6rem;
            margin-bottom: 0.8rem;
            color: #333;
            font-weight: 600;
        }

        #sessionModal p {
            font-size: 1.1rem;
            color: #666;
            margin-bottom: 2rem;
            line-height: 1.5;
        }

        /* Countdown Container - Specific to session modal */
        #sessionModal .countdown-container {
            position: relative;
            width: 100px;
            height: 100px;
            margin: 1.5rem auto;
        }

        #sessionModal .countdown-ring {
            width: 100px;
            height: 100px;
            border: 8px solid #f0f0f0;
            border-radius: 50%;
            position: absolute;
        }

        #sessionModal .countdown-progress {
            width: 100px;
            height: 100px;
            border: 8px solid transparent;
            border-top: 8px solid #4CAF50;
            border-radius: 50%;
            position: absolute;
            animation: sessionProgressSpin 1s linear infinite;
            transform-origin: center;
            transition: border-top-color 0.3s ease;
        }

        #sessionModal .countdown-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2.2rem;
            font-weight: bold;
            color: #4CAF50;
            transition: color 0.3s ease;
        }

        /* Modal Actions - Specific to session modal */
        #sessionModal .modal-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
        }

        #sessionModal .timer-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        #sessionModal .timer-btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

            #sessionModal .timer-btn-primary:hover {
                transform: translateY(-2px);
                box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
            }

        #sessionModal .timer-btn-secondary {
            background: #f8f9fa;
            color: #666;
            border: 2px solid #e9ecef;
        }

            #sessionModal .timer-btn-secondary:hover {
                background: #e9ecef;
                transform: translateY(-2px);
            }

    /* Fixed Animations - Using specific names to avoid conflicts */
    @@keyframes sessionModalSlideIn {
        from

    {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.7) translateY(-30px);
    }

    to {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1) translateY(0);
    }

    }

    @@keyframes sessionModalFadeOut {
        from

    {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
    }

    to {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.8);
    }

    }

    @@keyframes sessionModalBackdropFadeIn {
        from

    {
        opacity: 0;
    }

    to {
        opacity: 1;
    }

    }

    @@keyframes sessionIconPulse {
        0%, 100%

    {
        transform: scale(1);
    }

    50% {
        transform: scale(1.1);
    }

    }

    @@keyframes sessionProgressSpin {
        from

    {
        transform: rotate(0deg);
    }

    to {
        transform: rotate(360deg);
    }

    }
        
    </style>



    <!-- Session Timer Container - This is where the modal will be injected -->
    

    <div class="modal-backdrop" id="modalBackdrop"></div>
    <div class="session-timer-modal" id="sessionModal">
        <div class="timer-modal-icon">⏰</div>
        <h2>Session Timeout Warning</h2>
        <p>You've been inactive for a while. Your session will expire in:</p>

        <div class="countdown-container">
            <div class="countdown-ring"></div>
            <div class="countdown-progress" id="countdownProgress"></div>
            <div class="countdown-text" id="countdownText">10</div>
        </div>

        
    </div>

 

    <script>
        $(document).ready(function() {
            let inactivityTimer;
            let countdownInterval;
            let countdown = 10;
            let isModalShowing = false;

          

            // Initialize modal elements
            let $sessionModal,  $countdownText, $countdownProgress, $modalBackdrop;

            function initializeElements() {
                $sessionModal = $('#sessionModal');
                $countdownText = $('#countdownText');
                $countdownProgress = $('#countdownProgress');
                $modalBackdrop = $('#modalBackdrop');
            }

            function resetInactivityTimer() {
                clearTimeout(inactivityTimer);
                clearInterval(countdownInterval);

                // Hide modal if showing
                if (isModalShowing) {
                    hideModal();
                }

                

                // Start the inactivity timer
                // DEMO: 5 seconds - Change to (20 * 60 * 1000) for 20 minutes production
                inactivityTimer = setTimeout(function() {
                    showSessionModal();
                }, 20 * 60 * 1000);
            }

            

            function showSessionModal() {
                if (isModalShowing) return;

                isModalShowing = true;
                countdown = 10;

                $modalBackdrop.addClass('show');
                $sessionModal.addClass('show');
                updateCountdown();

                // Start countdown
                countdownInterval = setInterval(function() {
                    countdown--;
                    updateCountdown();

                    if (countdown <= 0) {
                        clearInterval(countdownInterval);
                        performLogout();
                    }
                }, 1000);
            }

            function hideModal() {
                if (!isModalShowing) return;

                $sessionModal.addClass('fadeOut');

                setTimeout(function() {
                    $sessionModal.removeClass('show fadeOut');
                    $modalBackdrop.removeClass('show');
                    isModalShowing = false;
                }, 300);

                clearInterval(countdownInterval);
                countdown = 10;
                updateCountdown();
            }

            function updateCountdown() {
                $countdownText.text(countdown);

                // Update colors based on remaining time
                let color = '#4CAF50';
                let textColor = '#4CAF50';

                if (countdown <= 3) {
                    color = '#ff6b6b';
                    textColor = '#ff6b6b';
                } else if (countdown <= 6) {
                    color = '#ff9800';
                    textColor = '#ff9800';
                }

                $countdownProgress.css('border-top-color', color);
                $countdownText.css('color', textColor);
            }

            function performLogout() {
                hideModal();

                 sessionLogout();
            }

            function sessionLogout(){
                localStorage.clear();
                localStorage.setItem("SessionOut","true")
                 window.location.href = uiBaseUrlLayout+'/AuthManage/Login';
            }
            
            initializeElements();

            // Event listeners for user activity
            $(document).on('mousemove keydown click scroll touchstart', function(e) {
            if (isModalShowing) return;
                resetInactivityTimer();
            });

            

            // Prevent modal from closing when clicking inside it
            $(document).on('click', '#sessionModal', function(e) {
                e.stopPropagation();
            });

                // Prevent modal from closing when clicking on the backdrop
                $(document).on('click', '#modalBackdrop', function(e) {
                    e.stopPropagation();
                    // Do not close the modal
                });


            // Start monitoring immediately
            resetInactivityTimer();
        });
    </script>
