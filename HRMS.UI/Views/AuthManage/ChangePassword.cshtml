@inject IConfiguration Configuration
@{
    ViewData["Title"] = "ChangePassword";
     Layout = null;
    string baseUrl = Configuration["BaseUrlSettings:baseUrl"];
    var uri = new Uri(baseUrl);
    string baseDomainUrl = $"{uri.Scheme}://{uri.Host}:{uri.Port}";
    string UIBaseUrl = Configuration["UIBaseUrlSettings:baseUrl"];
}



<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Change Password</title>

    <!-- CSS Dependencies -->
    <link rel="stylesheet" href="~/assets/plugins/notifications/css/lobibox.min.css" />
    <link href="~/assets/plugins/simplebar/css/simplebar.css" rel="stylesheet" />
    <link href="~/assets/plugins/perfect-scrollbar/css/perfect-scrollbar.css" rel="stylesheet" />
    <link href="~/assets/plugins/metismenu/css/metisMenu.min.css" rel="stylesheet" />
    <link href="~/assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="~/assets/css/bootstrap-extended.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <link href="~/assets/css/app.css" rel="stylesheet">
    <link href="~/assets/css/icons.css" rel="stylesheet">
    <link rel="stylesheet" href="~/assets/css/dark-theme.css" />
    <link rel="stylesheet" href="~/assets/css/semi-dark.css" />
    <link rel="stylesheet" href="~/assets/css/header-colors.css" />
    <link rel="stylesheet" href="https://cdn3.devexpress.com/jslib/21.1.5/css/dx.common.css">
    <link rel="stylesheet" href="https://cdn3.devexpress.com/jslib/21.1.5/css/dx.light.css">
    <link href="~/assets/css/company-modal.css" rel="stylesheet" />
    <link href="~/commoncss.css" rel="stylesheet" />
    <style>
        .fixed-label {
            min-width: 130px;
            white-space: nowrap;
            margin-bottom: 0;
            text-align: right;
        }
    </style>
</head>

<body class="bg-login">
    <div class="wrapper">




    <div class="card">
        <div class="card-header bg-transparent ml-0 py-0">
            <div class="row m-2">
                <div class="col-6 ">
                    <h6 class="pt-2 mb-0">
                    Change Password
                    </h6>
                </div>

                <div class="col-6 d-flex justify-content-end align-items-center">
                    <div class="font-22 pl-2" style="color:#32393f; cursor:pointer;">
                      
                    <button id="BackLogin"
                                type="button"
                                class="btn mr-1 rounded-1 "
                                style="background-color:black; color:white;">
                            Back
                        </button>
                    </div>
                </div>
            </div>
        </div>
    <div class="card-body">
        <form>
            <div class="col-md-8 mx-auto">
                <div class="row mb-2">
                    <label for="currentpassid" class="col-sm-4 col-form-label fixed-label">
                        Current Password <span class="text-danger">*</span>
                    </label>
                    <div class="col-sm-4">
                        <input type="text" class="form-control form-control-sm" id="currentpassid" />
                    </div>
                </div>
                <div class="row mb-2">
                    <label for="newpassid" class="col-sm-4 col-form-label fixed-label">
                        New Password <span class="text-danger">*</span>
                    </label>
                    <div class="col-sm-4">
                        <input type="text" class="form-control form-control-sm" id="newpassid" />
                    </div>
                </div>
                <div class="row mb-2">
                    <label for="confirmpassid" class="col-sm-4 col-form-label fixed-label">
                        Confirm Password <span class="text-danger">*</span>
                    </label>
                    <div class="col-sm-4">
                        <input type="text" class="form-control form-control-sm" id="confirmpassid" />
                    </div>
                </div>
                <div class="row mb-2">
                    <div class="col-sm-4"></div>
                    <div class="col-sm-4">
                        <button type="button" class="btn btn-primary btn-sm me-2" id="btnChangePassword">Change Password</button>
                        <button type="button" class="btn btn-secondary btn-sm" id="btnClear">Clear</button>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

    </div>
        <!-- JS Dependencies -->
        <script src="~/assets/js/jquery.min.js"></script>
        <script src="~/assets/js/bootstrap.bundle.min.js"></script>
        <script src="~/assets/plugins/simplebar/js/simplebar.min.js"></script>
        <script src="~/assets/plugins/metismenu/js/metisMenu.min.js"></script>
        <script src="~/assets/plugins/perfect-scrollbar/js/perfect-scrollbar.js"></script>
        <script src="~/assets/plugins/notifications/js/lobibox.min.js"></script>
        <script src="~/assets/plugins/notifications/js/notifications.min.js"></script>
        <script src="~/assets/plugins/notifications/js/notification-custom-script.js"></script>
        <script src="https://cdn3.devexpress.com/jslib/21.1.5/js/dx.all.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/jwt-decode@3.1.2/build/jwt-decode.min.js"></script>
        <script src="~/assets/js/app.js"></script>
        <script src="~/assets/js/companymodalloader.js"></script>

<!-- ✅ Include jQuery FIRST -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- ✅ Include SweetAlert -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
    var EmployeeId=localStorage.getItem('EmployeeId');
    $(document).ready(function () {

        $('#BackLogin').click(function () {
             window.location.href = '@UIBaseUrl/AuthManage/Login';

        });
        $('#btnChangePassword').click(function () {
            changePassword();
        });

        $('#btnClear').click(function () {
            $('#currentpassid, #newpassid, #confirmpassid').val('');
        });
    });

    function changePassword() {
        var currentPassword = $('#currentpassid').val().trim();
        var newPassword = $('#newpassid').val().trim();
       var confirmPassword = $('#confirmpassid').val().trim();

        if (!currentPassword || !newPassword || !confirmPassword) {
            Swal.fire("Validation Error", "All fields are required.", "warning");
            return;
        }

        if (newPassword !== confirmPassword) {
            Swal.fire("Validation Error", "New and Confirm Password must match.", "warning");
            return;
        }

        var payload = {
            EMPID: EmployeeId,
            CurrentPassword: currentPassword,
            NewPassword: newPassword
        };

        $.ajax({
            url: '@baseUrl/PasswordHistoryAPI/CreatePasswordHistory',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(payload),
            success: function (response) {
                if (response.isSuccess) {
                   // Swal.fire("Success", response.responseMessage, "success");
                     if (confirm('Password has been changed successfully.Do you want to go for login?')) {
                         window.location.href = '@UIBaseUrl/AuthManage/Login';

                      }   
                    $('#currentpassid, #newpassid, #confirmpassid').val('');
                } else {
                    Swal.fire("Error", response.responseMessage, "error");
                }
            },
            error: function () {
                Swal.fire("Error", "Something went wrong while calling API.", "error");
            }
        });
    }
</script>

</body>
</html>