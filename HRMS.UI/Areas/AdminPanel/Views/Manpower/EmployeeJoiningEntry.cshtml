@inject IConfiguration Configuration
@{
    ViewData["Title"] = "Employee Joining Entry";
    Layout = "~/Areas/AdminPanel/Views/Shared/_AdminLayout.cshtml";
    string baseUrl = Configuration["BaseUrlSettings:baseUrl"];
    string UIBaseUrlLayout = Configuration["UIBaseUrlSettings:baseUrl"];
    var uriAPI = new Uri(baseUrl);
    string baseAPIDomainUrl = $"{uriAPI.Scheme}://{uriAPI.Host}:{uriAPI.Port}";
}

<style>
    .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .header {
        background: linear-gradient(to right, #2c3e93, #d81b60);
        color: white;
        padding: 15px 20px;
        font-size: 18px;
        font-weight: bold;
    }

    .tabs {
        display: flex;
        background: #f8f9fa;
        border-bottom: 2px solid #ddd;
        overflow-x: auto;
        flex-wrap: wrap;
    }

    .tab {
        padding: 15px 25px;
        cursor: pointer;
        border: none;
        background: transparent;
        font-size: 14px;
        white-space: nowrap;
        transition: all 0.3s;
        border-bottom: 3px solid transparent;
    }

        .tab:hover {
            background: #e9ecef;
        }

        .tab.active {
            color: #d81b60;
            border-bottom-color: #d81b60;
            font-weight: bold;
        }

    .tab-content {
        display: none;
        padding: 30px;
        animation: fadeIn 0.3s;
    }

        .tab-content.active {
            display: block;
        }

    .form-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 10px;
    }

        .form-row.cols-3 {
            grid-template-columns: repeat(3, 1fr);
        }

        .form-row.cols-2 {
            grid-template-columns: repeat(2, 1fr);
        }

    .form-group {
        display: flex;
        flex-direction: column;
    }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

    /* Floating label specific styles - only border color */
    .floating-input:focus,
    .floating-input:not(:placeholder-shown) {
        border-color: #d81b60;
    }

    .button-group {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-top: 30px;
    }

    .btn {
        padding: 10px 30px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        font-weight: bold;
        transition: all 0.3s;
    }

    .btn-save {
        background: #00bcd4;
        color: white;
    }

        .btn-save:hover {
            background: #0097a7;
            transform: translateY(-1px);
        }

    .btn-exit {
        background: #f44336;
        color: white;
    }

        .btn-exit:hover {
            background: #d32f2f;
            transform: translateY(-1px);
        }

    .file-input-wrapper {
        position: relative;
        border: 1px dashed #ccc;
        padding: 10px;
        border-radius: 4px;
        text-align: center;
        background: #f9f9f9;
    }

        .file-input-wrapper input[type="file"] {
            cursor: pointer;
        }

</style>

<div class="container mb-5">
    <div class="header">Employee Joining Entry</div>
    <div class="tabs">
        <button class="tab active" onclick="openTab(event, 'employee-info')">Employee Info</button>
        <button class="tab" onclick="openTab(event, 'joining-details')">Joining Details</button>
        <button class="tab" onclick="openTab(event, 'salary-details')">Salary Details</button>
        <button class="tab" onclick="openTab(event, 'contact-details')">Contact Details</button>
        <button class="tab" onclick="openTab(event, 'document-details')">Documents Details</button>
    </div>

    <!-- Employee Info Tab -->
    <div id="employee-info" class="tab-content active">
        <form id="employeeInfoForm">
            <div class="form-row cols-2">
                <div class="form-group position-relative">
                    <select class="form-control floating-input" id="operationType">
                        <option value="">Select</option>
                        <option>Add New</option>
                    </select>
                    <label class="floating-label" for="operationType">Operation Type</label>
                </div>

                <div class="form-floating-custom">
                    <div class="searchable-select-wrapper" id="SelectReferenceNo">
                        <label for="ddlInitial">Reference No <span class="text-danger">*</span></label>
                        <input type="text" class="searchable-select-input" id="referenceNo" readonly>
                        <span class="searchable-select-arrow">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
                                <path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z" />
                            </svg>
                        </span>
                        <div class="searchable-select-dropdown">
                            <div class="searchable-select-search">
                                <input type="text" placeholder="Search initial..." class="search-input">
                            </div>
                            <div class="searchable-select-options"></div>
                        </div>
                    </div>
                    <span id="spnInitial" style="color:red; display:none;">Please Select Reference No</span>
                </div>
            </div>

            <div class="form-row cols-2">
                <div class="form-group position-relative">
                    <input type="text" class="form-control floating-input" id="employeeName" disabled placeholder="Name" value="GULSHAN YADAV">
                    <label class="floating-label" for="employeeName">Name<span class="required-star">*</span></label>
                </div>
                <div class="form-group position-relative">
                    <input type="email" class="form-control floating-input" disabled id="employeeEmail" placeholder="Email">
                    <label class="floating-label" for="employeeEmail">Email</label>
                </div>
            </div>

            <div class="form-row cols-2">
                <div class="form-group position-relative">
                    <textarea class="form-control floating-input" id="presentAddress" row="2" placeholder="Address (Present)"></textarea>
                    <label class="floating-label" for="presentAddress">Address (Present)</label>
                </div>
                <div class="form-group position-relative">
                    <textarea class="form-control floating-input" id="permanentAddress" row="2" placeholder="Address (Permanent)"></textarea>
                    <label class="floating-label" for="permanentAddress">Address (Permanent)</label>
                </div>
                
            </div>

            <div class="form-row cols-2">
                <div class="form-group position-relative">
                    <input type="text" class="form-control floating-input" id="lastEducation" disabled placeholder="Last Education">
                    <label class="floating-label" for="lastEducation">Last Education</label>
                </div>
                <div class="form-group position-relative">
                    <select class="form-control floating-input" id="maritalStatus">
                        <option value="">Select</option>
                        <option>Single</option>
                        <option>Married</option>
                    </select>
                    <label class="floating-label" for="maritalStatus">Marital Status</label>
                </div>
            </div>

            <div class="form-row cols-2">
                <div class="form-group position-relative">
                    <input type="date" class="form-control floating-input" id="dateOfBirth" placeholder="Date of Birth">
                    <label class="floating-label" for="dateOfBirth">Date of Birth</label>
                </div>
                <div class="form-group position-relative">
                    <input type="text" class="form-control floating-input" disabled id="totalExperience" placeholder="Total Experience" >
                    <label class="floating-label" for="totalExperience">Total Experience</label>
                </div>
            </div>

            <div class="form-row cols-2">
                <div class="form-group position-relative">
                    <input type="text" class="form-control floating-input" disabled id="mobileNo" placeholder="Mobile No.">
                    <label class="floating-label" for="mobileNo">Mobile No.<span class="required-star">*</span></label>
                </div>
                <div class="form-group position-relative">
                    <input type="text" class="form-control floating-input" id="bloodGroup" placeholder="Blood Group">
                    <label class="floating-label" for="bloodGroup">Blood Group</label>
                </div>
            </div>

            <div class="button-group">
                <button type="button" class="btn btn-save" id="btnEmployeeInfo">Save</button>
                <button type="button" class="btn btn-exit" onclick="BackToDashborad()">Exit</button>
            </div>
        </form>
    </div>

    <!-- Joining Details Tab -->
    <div id="joining-details" class="tab-content">
        <form id="joiningDetailsForm">
            <div class="form-row cols-2">
                <div class="form-group position-relative">
                    <input type="text" class="form-control floating-input" id="branchName" disabled placeholder="Branch Name" value="GURGAON">
                    <label class="floating-label" for="branchName">Branch Name</label>
                </div>
                <div class="form-group position-relative">
                    <input type="text" class="form-control floating-input" disabled id="reportingTo" placeholder="Reporting To" value="Samrat">
                    <label class="floating-label" for="reportingTo">Reporting To</label>
                </div>
            </div>

            <div class="form-row cols-2">
                <div class="form-group position-relative">
                    <input type="text" class="form-control floating-input" id="department" disabled placeholder="Department" value="Operation">
                    <label class="floating-label" for="department">Department</label>
                </div>
                <div class="form-group position-relative">
                    <input type="text" class="form-control floating-input" id="interviewedBy" placeholder="Interviewed By">
                    <label class="floating-label" for="interviewedBy">Interviewed By</label>
                </div>
            </div>

            <div class="form-row cols-2">
                <div class="form-group position-relative">
                    <input type="text" class="form-control floating-input" id="designation" disabled placeholder="Designation" value="Pick up & delivery Boy">
                    <label class="floating-label" for="designation">Designation</label>
                </div>
                <div class="form-group position-relative">
                    <input type="date" class="form-control floating-input" id="interviewDate" placeholder="Interview Date">
                    <label class="floating-label" for="interviewDate">Interview Date</label>
                </div>
            </div>

            <div class="form-row cols-2">
                <div class="form-group position-relative">
                    <input type="date" class="form-control floating-input" id="dateOfJoining" disabled placeholder="Date of Joining" value="2025-02-04">
                    <label class="floating-label" for="dateOfJoining">Date of Joining</label>
                </div>
                <div class="form-group position-relative">
                    <input type="text" class="form-control floating-input" id="interviewPlace" placeholder="Interview Place">
                    <label class="floating-label" for="interviewPlace">Interview Place</label>
                </div>
            </div>

            <div class="form-row cols-2">
                <div class="form-group position-relative">
                    <input type="text" class="form-control floating-input" id="clientName" placeholder="Client Name">
                    <label class="floating-label" for="clientName">Client Name</label>
                </div>
                <div class="form-group position-relative">
                    <input type="text" class="form-control floating-input" id="erpCode" placeholder="ERP CODE">
                    <label class="floating-label" for="erpCode">ERP CODE</label>
                </div>
            </div>

            <div class="form-row cols-2">
                <div class="form-group position-relative">
                    <input type="text" class="form-control floating-input" id="previousCompanyUAN" placeholder="Previous Company UAN">
                    <label class="floating-label" for="previousCompanyUAN">Previous Company UAN</label>
                </div>
                <div class="form-group position-relative">
                    <input type="text" class="form-control floating-input" id="previousCompanyESIC" placeholder="Previous Company ESIC">
                    <label class="floating-label" for="previousCompanyESIC">Previous Company ESIC</label>
                </div>
            </div>

            <div class="button-group">
                <button type="submit" class="btn btn-save">Save</button>
                <button type="reset" class="btn btn-exit" onclick="BackToDashborad()">Exit</button>
            </div>
        </form>
    </div>

    <!-- Salary Details Tab -->
    <div id="salary-details" class="tab-content">
        <form id="salaryDetailsForm">
            <div class="form-row cols-2">
                <div class="form-group position-relative">
                    <input type="text" class="form-control floating-input" id="pfUAN" placeholder="PF UAN">
                    <label class="floating-label" for="pfUAN">PF UAN</label>
                </div>
                <div class="form-group position-relative">
                    <input type="text" class="form-control floating-input" id="esicNo" placeholder="ESIC No.">
                    <label class="floating-label" for="esicNo">ESIC No.</label>
                </div>
            </div>

            <div class="form-row cols-2">
                <div class="form-group position-relative">
                    <input type="text" class="form-control floating-input" id="pan" placeholder="PAN">
                    <label class="floating-label" for="pan">PAN</label>
                </div>
                <div class="form-group position-relative">
                    <input type="text" class="form-control floating-input" id="grossSalary" disabled placeholder="Gross Salary" value="15000.00">
                    <label class="floating-label" for="grossSalary">Gross Salary</label>
                </div>
                
            </div>

            <div class="form-row cols-2">
                <div class="form-group position-relative">
                    <input type="text" class="form-control floating-input" id="netSalary" disabled placeholder="Net Salary" value="15000.00">
                    <label class="floating-label" for="netSalary">Net Salary</label>
                </div>
            </div>

            <div class="button-group">
                <button type="submit" class="btn btn-save">Save</button>
                <button type="reset" class="btn btn-exit" onclick="BackToDashborad()">Exit</button>
            </div>
        </form>
    </div>

    <!-- Contact Details Tab -->
    <div id="contact-details" class="tab-content">
        <form id="contactDetailsForm">
            <div class="form-row cols-3">
                <div class="form-group position-relative">
                    <input type="text" class="form-control floating-input" id="contactMobileNo1" placeholder="Mobile No.">
                    <label class="floating-label" for="contactMobileNo1">Mobile No.</label>
                </div>
                <div class="form-group position-relative">
                    <input type="text" class="form-control floating-input" id="contactPersonName1" placeholder="Contact Person Name">
                    <label class="floating-label" for="contactPersonName1">Contact Person Name</label>
                </div>
                <div class="form-group position-relative">
                    <input type="text" class="form-control floating-input" id="contactPersonRelation1" placeholder="Relation">
                    <label class="floating-label" for="contactPersonRelation1">Relation</label>
                </div>
            </div>

            <div class="form-row cols-3">
                <div class="form-group position-relative">
                    <input type="text" class="form-control floating-input" id="contactMobileNo2" placeholder="Mobile No.">
                    <label class="floating-label" for="contactMobileNo2">Mobile No.</label>
                </div>
                <div class="form-group position-relative">
                    <input type="text" class="form-control floating-input" id="contactPersonName2" placeholder="Contact Person Name">
                    <label class="floating-label" for="contactPersonName2">Contact Person Name</label>
                </div>
                <div class="form-group position-relative">
                    <input type="text" class="form-control floating-input" id="contactPersonRelation2" placeholder="Relation">
                    <label class="floating-label" for="contactPersonRelation2">Relation</label>
                </div>
            </div>

            <div class="form-row cols-3">
                <div class="form-group position-relative">
                    <input type="text" class="form-control floating-input" id="contactMobileNo3" placeholder="Mobile No.">
                    <label class="floating-label" for="contactMobileNo3">Mobile No.</label>
                </div>
                <div class="form-group position-relative">
                    <input type="text" class="form-control floating-input" id="contactPersonName3" placeholder="Contact Person Name">
                    <label class="floating-label" for="contactPersonName3">Contact Person Name</label>
                </div>
                <div class="form-group position-relative">
                    <input type="text" class="form-control floating-input" id="contactPersonRelation3" placeholder="Relation">
                    <label class="floating-label" for="contactPersonRelation3">Relation</label>
                </div>
            </div>

            <div class="button-group">
                <button type="submit" class="btn btn-save">Save</button>
                <button type="reset" class="btn btn-exit" onclick="BackToDashborad()">Exit</button>
            </div>
        </form>
    </div>

    <!-- Document Details Tab -->
    <div id="document-details" class="tab-content">
        <form id="documentDetailsForm">
            <div class="form-row cols-2">
                <div class="form-group position-relative">
                    <input type="text" class="form-control floating-input" id="aadharCardNo" placeholder="Aadhar Card No">
                    <label class="floating-label" for="aadharCardNo">Aadhar Card No</label>
                </div>
                <div class="form-group">
                    <label for="aadharCardCopy">Upload Aadhar Card Copy</label>
                    <div class="file-input-wrapper">
                        <input type="file" id="aadharCardCopy" accept="image/*">
                    </div>
                </div>
            </div>

            <div class="form-row cols-2">
                <div class="form-group position-relative">
                    <input type="text" class="form-control floating-input" id="panCardNo" placeholder="Pan Card No">
                    <label class="floating-label" for="panCardNo">Pan Card No</label>
                </div>
                <div class="form-group">
                    <label for="panCardCopy">Upload Pan Card Copy</label>
                    <div class="file-input-wrapper">
                        <input type="file" id="panCardCopy" accept="image/*">
                    </div>
                </div>
            </div>

            <div class="form-row cols-2">
                <div class="form-group">
                    <label for="freshResume">Fresh Resume</label>
                    <div class="file-input-wrapper">
                        <input type="file" id="freshResume" accept="image/*">
                    </div>
                </div>
                <div class="form-group">
                    <label for="passportSizePhoto">Passport Size Photo Copy</label>
                    <div class="file-input-wrapper">
                        <input type="file" id="passportSizePhoto" accept="image/*">
                    </div>
                </div>
            </div>

            <div class="form-row cols-2">
                <div class="form-group">
                    <label for="cancelledCheque">Cancelled Cheque</label>
                    <div class="file-input-wrapper">
                        <input type="file" id="cancelledCheque" accept="image/*">
                    </div>
                </div>
                <div class="form-group">
                    <label for="payslip">Payslip</label>
                    <div class="file-input-wrapper">
                        <input type="file" id="payslip" accept="image/*">
                    </div>
                </div>
            </div>

            <div class="form-row cols-2">
                <div class="form-group">
                    <label for="experienceCertificate">Experience Certificate</label>
                    <div class="file-input-wrapper">
                        <input type="file" id="experienceCertificate" accept="image/*">
                    </div>
                </div>
            </div>

            <div class="button-group">
                <button type="submit" class="btn btn-save">Save</button>
                <button type="reset" class="btn btn-exit" onclick="BackToDashborad()">Exit</button>
            </div>
        </form>
    </div>
</div>

<script src="~/assets/js/jquery.min.js"></script>
<script>
    var companyDetails = JSON.parse(localStorage.getItem('selectedCompany'));
    const CompanyId = companyDetails.CompanyId;
    const EmployeeId = localStorage.getItem('EmployeeId');
    const Token = localStorage.getItem("authToken");

    function openTab(evt, tabName) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tab-content");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].classList.remove("active");
        }
        tablinks = document.getElementsByClassName("tab");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].classList.remove("active");
        }
        document.getElementById(tabName).classList.add("active");
        evt.currentTarget.classList.add("active");
    }

   
    function BackToDashborad()
    {
        window.location.href="@UIBaseUrlLayout/AdminPanel/Home/index";
    }
</script>
<script>

    $(document).ready(function(){
        loadRefrence();
    });

     async function loadRefrence() {
        debugger;
        console.log("Calling API with CompanyId:", CompanyId);

        $.ajax({
            type: 'POST',
            url: '@baseUrl/ManpowerRequisitionAPI/GetAllSerialNo',
            data: JSON.stringify({ CompanyId: CompanyId }), // Ensure CompanyId is defined
            contentType: 'application/json',
            headers: {
                'Authorization': 'Bearer ' + Token // Ensure Token is defined
            },
            success: function(response) {
                console.log("API Response:", response);
                if (response.isSuccess) {
                    bindSerial(response.data);
                } else {
                    console.error("API Error:", response.responseMessage);
                }
            },
            error: function(xhr, status, error) {
                console.error("AJAX Error:", status, error);
            }
        });
    }


      function bindSerial(data)
     {
        debugger
            $('#referenceNo').searchableSelect({
              data: data||[],
                valueKey: 'manpowerRequisitionId',
                textKey: 'serialNo',
                placeholder:'Reference',
                searchPlaceholder: 'Search reference...',
              onChange: function(item) {
                  loadManpowerDetails(item.manpowerRequisitionId);
              }
          });
     }

     async function loadManpowerDetails(Id) {
        debugger;
       
        $.ajax({
            type: 'GET',
            url: '@baseUrl/ManpowerRequisitionAPI/GetManpowerRequisitionByManpowerRequisitionId/'+Id,
            headers: {
                'Authorization': 'Bearer ' + Token // Ensure Token is defined
            },
            success: function(response) {
                console.log("Manpower Response:", response);
                if (response.isSuccess) {
                   populateFormWithApiData(response.data);
                } else {
                    console.error("API Error:", response.responseMessage);
                }
            },
            error: function(xhr, status, error) {
                console.error("AJAX Error:", status, error);
            }
        });
    }

     function populateFormWithApiData(apiData) {
        // Employee Info Tab
        //$('#operationType').val('Add New');
        $('#referenceNo').val(apiData.serialNo || '');

        // Set the display value for the searchable select
        if (apiData.serialNo) {
            $('.searchable-select-input').val(apiData.serialNo);
        }

        $('#employeeName').val(apiData.employeeName || '');
        $('#employeeEmail').val(apiData.personalEmail || '');
        $('#totalExperience').val(apiData.experienceRange || '');
        $('#mobileNo').val(apiData.contactNumber || '');

        // Joining Details Tab
        $('#branchName').val(apiData.branchName || '');
        $('#reportingTo').val(apiData.reportingName || '');
        $('#department').val(apiData.departmentName || '');
        $('#designation').val(apiData.designationName || '');

        // Format dates
        if (apiData.dateOfJoining) {
            const dateOfJoining = new Date(apiData.dateOfJoining);
            const formattedDate = dateOfJoining.toISOString().split('T')[0];
            $('#dateOfJoining').val(formattedDate);
        }

       
        // Salary Details Tab
        $('#grossSalary').val(apiData.grossSalary || '');
        $('#netSalary').val(apiData.takeHomeSalary || '');

        // Trigger floating label effect for filled fields
        $('input, select, textarea').each(function() {
            if ($(this).val()) {
                $(this).addClass('has-value');
            }
        });
    }

</script>

<script>
     async function getFormData() {
        const formData = {
            Action:"UPDATE_EmployeeInfo",
             ManpowerRequisitionId: $('#referenceNo').val() || null,
            operationType: $('#operationType').val() || null,
            employeeName: $('#employeeName').val() || null,
            employeeEmail: $('#employeeEmail').val() || null,
            presentAddress: $('#presentAddress').val() || null,
            permanentAddress: $('#permanentAddress').val() || null,
            lastEducation: $('#lastEducation').val() || null,
            maritalStatus: $('#maritalStatus').val() || null,
            dateOfBirth: $('#dateOfBirth').val() || null,
            totalExperience: $('#totalExperience').val() || null,
            mobileNo: $('#mobileNo').val() || null,
            bloodGroup: $('#bloodGroup').val() || null
        };
        return formData;
    }

    $("#btnEmployeeInfo").click(async ()=>
    {
        const formData = await getFormData();
        console.log(formData);
        debugger;
        $.ajax({
            url: '@baseUrl/ManpowerRequisitionAPI/UpdateJoinningDetails',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(formData),
            success: function(response) {
                if(response.isSuccess)
                {
                    round_success_noti(response.responseMessage);
                }
                else
                {
                    round_error_noti(response.responseMessage)
                }
            },
            error: function(xhr, status, error) {
                alert('Error saving data: ' + error);
            }
        });
    });


</script>