

@inject IConfiguration Configuration
@{
    ViewData["Title"] = "Employee Joining Entry";
    Layout = "~/Areas/AdminPanel/Views/Shared/_AdminLayout.cshtml";
    string baseUrl = Configuration["BaseUrlSettings:baseUrl"];
    string UIBaseUrlLayout = Configuration["UIBaseUrlSettings:baseUrl"];
    var uriAPI = new Uri(baseUrl);
    string baseAPIDomainUrl = $"{uriAPI.Scheme}://{uriAPI.Host}:{uriAPI.Port}";
}
    <style>
       

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin-bottom:20px;
        }

        .header {
            background: linear-gradient(135deg, #2c3e93 0%, #d81b60 100%);
            color: white;
            padding: 20px 30px;
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e0e0e0;
            overflow-x: auto;
            flex-wrap: wrap;
        }

        .tab {
            padding: 18px 28px;
            cursor: pointer;
            border: none;
            background: transparent;
            font-size: 15px;
            white-space: nowrap;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            color: #555;
            font-weight: 500;
        }

            .tab:hover {
                background: #e9ecef;
                color: #2c3e93;
            }

            .tab.active {
                color: #d81b60;
                border-bottom-color: #d81b60;
                font-weight: bold;
                background: white;
            }

        .tab-content {
            display: none;
            padding: 35px;
            animation: fadeIn 0.4s ease;
        }

            .tab-content.active {
                display: block;
            }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 5px;
        }

            .form-row.cols-3 {
                grid-template-columns: repeat(3, 1fr);
            }

            .form-row.cols-2 {
                grid-template-columns: repeat(2, 1fr);
            }

        .form-group {
            display: flex;
            flex-direction: column;
        }

            .form-group.full-width {
                grid-column: 1 / -1;
            }

            .form-group label {
                font-size: 14px;
                margin-bottom: 5px;
                color: #333;
                font-weight: 600;
            }

        .form-control {
            padding: 4px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: white;
        }

            .form-control:focus {
                outline: none;
                border-color: #d81b60;
                box-shadow: 0 0 0 3px rgba(216, 27, 96, 0.1);
            }

            .form-control:disabled {
                background-color: #f5f5f5;
                cursor: not-allowed;
                color: #666;
            }

        textarea.form-control {
            resize: vertical;
            min-height: 80px;
            font-family: inherit;
        }

        select.form-control {
            cursor: pointer;
        }

        .required-star {
            color: #f44336;
            margin-left: 2px;
        }

        .button-group {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
            padding-top: 20px;
            border-top: 2px solid #f0f0f0;
        }

        .btn {
            padding: 6px 40px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 15px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .btn-save {
            background: linear-gradient(135deg, #00bcd4 0%, #0097a7 100%);
            color: white;
        }

            .btn-save:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 12px rgba(0,188,212,0.3);
            }

        .btn-exit {
            background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
            color: white;
        }

            .btn-exit:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 12px rgba(244,67,54,0.3);
            }

        .file-input-wrapper {
            position: relative;
            border: 2px dashed #d0d0d0;
            padding: 20px;
            border-radius: 6px;
            text-align: center;
            background: #fafafa;
            transition: all 0.3s ease;
        }

            .file-input-wrapper:hover {
                border-color: #d81b60;
                background: #fff5f8;
            }

            .file-input-wrapper input[type="file"] {
                cursor: pointer;
                width: 100%;
            }

        @@keyframes fadeIn {
            from

        {
            opacity: 0;
            transform: translateY(10px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }

        }

        /* Tablet view */
        @@media (max-width: 992px) {
            .form-row.cols-3

        {
            grid-template-columns: repeat(2, 1fr);
        }

        .header {
            font-size: 20px;
            padding: 18px 25px;
        }

        .tab {
            padding: 15px 22px;
            font-size: 14px;
        }

        }

        /* Mobile view - One field per row */
   
        @@media (max-width: 768px) {
            body

        {
            padding: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .container {
            margin: 0;
            border-radius: 8px;
        }

        .header {
            padding: 15px 20px;
            font-size: 18px;
        }

        .tabs {
            padding: 0;
        }

        .tab {
            padding: 14px 18px;
            font-size: 13px;
            flex: 1;
            min-width: auto;
        }

        .tab-content {
            padding: 25px 20px;
        }

        /* Make all form rows single column on mobile */
        .form-row,
        .form-row.cols-2,
        .form-row.cols-3 {
            grid-template-columns: 1fr !important;
            gap: 20px;
        }

        .button-group {
            flex-direction: column;
            gap: 12px;
        }

        .btn {
            width: 100%;
            padding: 6px 20px;
        }

        .file-input-wrapper {
            padding: 18px 15px;
        }

        .form-control {
            padding: 4px 13px;
        }

        }

        /* Extra small mobile devices */
        @@media (max-width: 480px) {
            .header

        {
            font-size: 16px;
            padding: 12px 15px;
        }

        .tab {
            padding: 12px 15px;
            font-size: 12px;
        }

        .tab-content {
            padding: 20px 15px;
        }

        .form-row {
            gap: 18px;
            margin-bottom: 15px;
        }

        .form-group label {
            font-size: 13px;
        }

        .form-control {
            font-size: 13px;
        }

        }

        /* Scrollbar styling */
        .tabs::-webkit-scrollbar {
            height: 4px;
        }

        .tabs::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .tabs::-webkit-scrollbar-thumb {
            background: #d81b60;
            border-radius: 4px;
        }

    .error-message{
        color:red;
        display:none;
    }
    </style>

    <div class="container">
        <div class="header">📋 Employee Joining Entry</div>
        <div class="tabs">
            <button class="tab active" onclick="openTab(event, 'employee-info')">👤 Employee Info</button>
            <button class="tab" onclick="openTab(event, 'joining-details')">🏢 Joining Details</button>
            <button class="tab" onclick="openTab(event, 'salary-details')">💰 Salary Details</button>
            <button class="tab" onclick="openTab(event, 'contact-details')">📞 Contact Details</button>
            <button class="tab" onclick="openTab(event, 'document-details')">📄 Documents</button>
        </div>

        <!-- Employee Info Tab -->
        <div id="employee-info" class="tab-content active">
            <form>
                <div class="form-row cols-2">
                    <div class="form-group">
                        <label for="operationType">Operation Type</label>
                        <select class="form-control" id="operationType">
                            <option value="">Select</option>
                            <option selected>Add New</option>
                        </select>
                    </div>
                 
                   <div class="form-group">
                    <label class="form-label">Reference No<span class="text-danger">*</span></label>
                    <div class="form-floating-custom flex-grow-1">
                        <div class="searchable-select-wrapper" id="referenceWrapper">
                            <input type="text" class="searchable-select-input" id="referenceNo" readonly>
                            <span class="searchable-select-arrow">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
                                    <path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z" />
                                </svg>
                            </span>
                            <div class="searchable-select-dropdown">
                                <div class="searchable-select-search">
                                    <input type="text" placeholder="Search month..." class="search-input">
                                </div>
                                <div class="multi-select-actions">
                                    <button type="button" class="multi-select-btn select-all-btn">Select All</button>
                                    <button type="button" class="multi-select-btn clear-all-btn">Clear All</button>
                                </div>
                                <div class="searchable-select-options"></div>
                            </div>
                        </div>
                        <span class=" error-message" id="errorReference">Please select reference no</span>
                    </div>
                </div>
                </div>

                <div class="form-row cols-2">
                    <div class="form-group">
                        <label for="employeeName">Name </label>
                        <input type="text" class="form-control" id="employeeName" disabled value="">
                    <span class=" error-message" id="errorName">Please select name</span>
                    </div>
                    <div class="form-group">
                        <label for="employeeEmail">Email</label>
                        <input type="email" class="form-control" id="employeeEmail" disabled placeholder="email@example.com">
                    <span class=" error-message" id="errorEmil">Please select email</span>

                    </div>
                </div>

                <div class="form-row cols-2">
                    <div class="form-group">
                        <label for="presentAddress">Address (Present)</label>
                        <textarea class="form-control" id="presentAddress" rows="2" placeholder="Enter present address"></textarea>
                    <span class=" error-message" id="errorPresentAddress">Please select present address</span>

                    </div>
                    <div class="form-group">
                        <label for="permanentAddress">Address (Permanent)</label>
                        <textarea class="form-control" id="permanentAddress" rows="2" placeholder="Enter permanent address"></textarea>
                    <span class=" error-message" id="errorPermanentAddress">Please select permanent address</span>

                    </div>
                </div>

                <div class="form-row cols-2">
                    <div class="form-group">
                        <label for="lastEducation">Last Education</label>
                        <input type="text" class="form-control" id="lastEducation" disabled placeholder="Highest qualification">
                    <span class=" error-message" id="errorLastEducation">Please select last education</span>

                    </div>
                    <div class="form-group">
                        <label for="maritalStatus">Marital Status</label>
                        <select class="form-control" id="maritalStatus">
                            <option value="">Select</option>
                            <option>Single</option>
                            <option>Married</option>
                        </select>
                    <span class=" error-message" id="errorMaritalStatus">Please select marital status</span>
                    </div>
                </div>

                <div class="form-row cols-2">
                    <div class="form-group">
                        <label for="dateOfBirth">Date of Birth</label>
                        <input type="date" class="form-control" id="dateOfBirth">
                    <span class=" error-message" id="errorDateofBirth">Please select date of Birth</span>

                    </div>
                    <div class="form-group">
                        <label for="totalExperience">Total Experience</label>
                        <input type="text" class="form-control" id="totalExperience" disabled placeholder="Years of experience">
                    <span class=" error-message" id="errorTotalExperience">Please select total experience</span>

                    </div>
                </div>

                <div class="form-row cols-2">
                    <div class="form-group">
                        <label for="mobileNo">Mobile No.</label>
                        <input type="text" class="form-control" id="mobileNo" disabled placeholder="10-digit mobile number">
                    </div>
                    <div class="form-group">
                        <label for="bloodGroup">Blood Group</label>
                        <input type="text" class="form-control" id="bloodGroup" placeholder="e.g., O+, A+, B+">
                    </div>
                </div>

                <div class="button-group">
                <button type="button" class="btn btn-save" id="btnEmployeeInfo">Save</button>
                <button type="button" class="btn btn-exit" onclick="BackToDashborad()">Exit</button>
                </div>
            </form>
        </div>

        <!-- Joining Details Tab -->
        <div id="joining-details" class="tab-content">
            <form>
                <div class="form-row cols-2">
                    <div class="form-group">
                        <label for="branchName">Branch Name</label>
                        <input type="text" class="form-control" id="branchName" disabled >
                    </div>
                    <div class="form-group">
                        <label for="reportingTo">Reporting To</label>
                        <input type="text" class="form-control" id="reportingTo" disabled >
                    </div>
                </div>

                <div class="form-row cols-2">
                    <div class="form-group">
                        <label for="department">Department</label>
                        <input type="text" class="form-control" id="department" disabled >
                    </div>
                    <div class="form-group">
                        <label for="interviewedBy">Interviewed By</label>
                        <input type="text" class="form-control" id="interviewedBy" placeholder="Interviewer name">
                    </div>
                </div>

                <div class="form-row cols-2">
                    <div class="form-group">
                        <label for="designation">Designation</label>
                        <input type="text" class="form-control" id="designation" disabled >
                    </div>
                    <div class="form-group">
                        <label for="interviewDate">Interview Date</label>
                        <input type="date" class="form-control" id="interviewDate">
                    </div>
                </div>

                <div class="form-row cols-2">
                    <div class="form-group">
                        <label for="dateOfJoining">Date of Joining</label>
                        <input type="date" class="form-control" id="dateOfJoining" disabled >
                    </div>
                    <div class="form-group">
                        <label for="interviewPlace">Interview Place</label>
                        <input type="text" class="form-control" id="interviewPlace" placeholder="Interview location">
                    </div>
                </div>

                <div class="form-row cols-2">
                    <div class="form-group">
                        <label for="clientName">Client Name</label>
                        <input type="text" class="form-control" id="clientName" placeholder="Client name">
                    </div>
                    <div class="form-group">
                        <label for="erpCode">ERP CODE</label>
                        <input type="text" class="form-control" id="erpCode" placeholder="ERP code">
                    </div>
                </div>

                <div class="form-row cols-2">
                    <div class="form-group">
                        <label for="previousCompanyUAN">Previous Company UAN</label>
                        <input type="text" class="form-control" id="previousCompanyUAN" placeholder="UAN number">
                    </div>
                    <div class="form-group">
                        <label for="previousCompanyESIC">Previous Company ESIC</label>
                        <input type="text" class="form-control" id="previousCompanyESIC" placeholder="ESIC number">
                    </div>
                </div>

                <div class="button-group">
                <button type="button" class="btn btn-save" id="btnJoiningDetails">Save</button>
                <button type="button" class="btn btn-exit" onclick="BackToDashborad()">Exit</button>
                </div>
            </form>
        </div>

        <!-- Salary Details Tab -->
        <div id="salary-details" class="tab-content">
            <form>
                <div class="form-row cols-2">
                    <div class="form-group">
                        <label for="pfUAN">PF UAN</label>
                        <input type="text" class="form-control" id="pfUAN" placeholder="PF UAN number">
                    <span class=" error-message" id="errorpfuan">Please enter PF UAN</span>
                    </div>
                    <div class="form-group">
                        <label for="esicNo">ESIC No.</label>
                        <input type="text" class="form-control" id="esicNo" placeholder="ESIC number">
                    <span class=" error-message" id="errorESICNo">Please enter ESIC No</span>
                    </div>
                </div>

                <div class="form-row cols-2">
                    <div class="form-group">
                        <label for="pan">PAN</label>
                        <input type="text" class="form-control" id="pan" placeholder="PAN number">
                    <span class=" error-message" id="errorPanPAN">Please enter PAN </span>
                    </div>
                    <div class="form-group">
                        <label for="grossSalary">Gross Salary</label>
                        <input type="text" class="form-control" id="grossSalary" disabled >
                    </div>
                <span class=" error-message" id="errorGrossSalary">Please enter gross salary</span>
                </div>

                <div class="form-row cols-2">
                    <div class="form-group">
                        <label for="netSalary">Net Salary</label>
                        <input type="text" class="form-control" id="netSalary" disabled >
                    </div>
                <span class=" error-message" id="errorNetSalary">Please enter net salary</span>
                </div>

                <div class="button-group">
                    <button type="button" class="btn btn-save" id="btnSalary">Save</button>
                <button type="button" class="btn btn-exit" onclick="BackToDashborad()">Exit</button>
                </div>
            </form>
        </div>

        <!-- Contact Details Tab -->
  
        <div id="contact-details" class="tab-content">
            <form id="manpowerRelationForm">
                <div class="form-row cols-3">
                    <div class="form-group">
                        <label for="contactPersonName">Contact Person Name <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="contactPersonName" placeholder="Person name">
                        <span class="error-message" id="errorName">Please enter a name</span>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Relationship <span class="text-danger">*</span></label>
                        <div class="form-floating-custom flex-grow-1">
                            <div class="searchable-select-wrapper" id="referenceWrapper">
                                <input type="text" class="searchable-select-input" id="contactPersonRelation" readonly>
                                <span class="searchable-select-arrow">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
                                        <path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z" />
                                    </svg>
                                </span>
                                <div class="searchable-select-dropdown">
                                    <div class="searchable-select-search">
                                        <input type="text" placeholder="Search relation..." class="search-input">
                                    </div>
                                    <div class="searchable-select-options" id="relationOptions">
                                        <!-- Options will be loaded dynamically -->
                                    </div>
                                </div>
                            </div>
                            <span class="error-message" id="errorRelaioin" >select a relation</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="contactMobileNo1">Mobile No. <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="contactMobileNo" placeholder="Mobile number">
                        <span class="error-message" id="errorMobile">Please enter a valid mobile number</span>
                    </div>
                </div>

                <div class="button-group">
                    <button type="button" class="btn btn-save" id="btnRelation">Save</button>
                    <button type="button" class="btn btn-exit" onclick="BackToDashboard()">Exit</button>
                </div>
            </form>

        <div>
           <div class="grid-wrapper " style="position: relative; " id="gridTag">
            <div id="grid-loader" class="grid-loader justify-content-center align-items-center flex-column "
                 style="display: none;  inset: 0; background: rgba(255,255,255,0.6); z-index: 10; ">
                <img src="@baseAPIDomainUrl/loders/loder.png" class="grid-logo-spinner" style="width: 30px; height: 30px; animation: spin 1s linear infinite;" />
                <div class="grid-loading-text text-dark" style="font-size: 16px;">Loading...</div>

            </div>
            <div id="rowCountRelation"></div>
            <div id="GridRelationContainer"></div>
        </div>

         </div>

        </div>

       
        <!-- Document Details Tab -->
        <div id="document-details" class="tab-content">
            <form>
                <div class="form-row cols-2">
                <div class="form-group">
                    <label class="form-label">Document Name<span class="text-danger">*</span></label>
                    <div class="form-floating-custom flex-grow-1">
                        <div class="searchable-select-wrapper" id="referenceWrapper">
                            <input type="text" class="searchable-select-input" id="documentName" readonly>
                            <span class="searchable-select-arrow">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
                                    <path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z" />
                                </svg>
                            </span>
                            <div class="searchable-select-dropdown">
                                <div class="searchable-select-search">
                                    <input type="text" placeholder="Search relation..." class="search-input">
                                </div>
                                <div class="multi-select-actions">
                                    <button type="button" class="multi-select-btn select-all-btn">Select All</button>
                                    <button type="button" class="multi-select-btn clear-all-btn">Clear All</button>
                                </div>
                                <div class="searchable-select-options"></div>
                            </div>
                        </div>
                        <span class=" error-message" id="errorDocument">Please select document</span>
                    </div>
                </div>


                <div class="form-group">
                    <label for="document">Document</label>
                        <div class="file-input-wrapper">
                            <input type="file" id="document" accept="image/*,application/pdf">
                            <small>📎 Choose file or drag here</small>
                        </div>
                    </div>
                </div>

                <div class="form-row cols-2">
                    <div class="form-group">
                        <label for="dateOfExpiry">Date of Expiry</label>
                    <input type="date" class="form-control" id="dateOfExpiry" >
                    </div>
                    
                    <div class="form-group">
                    <label for="comment">Comment</label>
                    <textarea class="form-control" id="comment" placeholder="comment"></textarea>
                    </div>
                    
                </div>

              
                <div class="button-group">
                    <button type="button" class="btn btn-save" id="btnDocument">Save</button>
                <button type="button" class="btn btn-exit" onclick="BackToDashborad()"> Exit</button>
                </div>
            </form>

        <div>
            <div class="grid-wrapper " style="position: relative; " id="gridTag">
                <div id="grid-loader" class="grid-loader justify-content-center align-items-center flex-column "
                     style="display: none;  inset: 0; background: rgba(255,255,255,0.6); z-index: 10; ">
                    <img src="@baseAPIDomainUrl/loders/loder.png" class="grid-logo-spinner" style="width: 30px; height: 30px; animation: spin 1s linear infinite;" />
                    <div class="grid-loading-text text-dark" style="font-size: 16px;">Loading...</div>

                </div>
                <div id="rowCountDocument"></div>
                <div id="GridDocumentContainer"></div>
            </div>
        </div>

    </div>

<script src="~/assets/js/jquery.min.js"></script>
    <script>
        var companyDetails = JSON.parse(localStorage.getItem('selectedCompany'));
    const CompanyId = companyDetails.CompanyId;
    const EmployeeId = localStorage.getItem('EmployeeId');
    const Token = localStorage.getItem("authToken");

        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].classList.remove("active");
            }
            tablinks = document.getElementsByClassName("tab");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].classList.remove("active");
            }
            document.getElementById(tabName).classList.add("active");
            evt.currentTarget.classList.add("active");
        }
            function BackToDashborad()
            {
                window.location.href="@UIBaseUrlLayout/AdminPanel/Home/index";
            }
    </script>

    <script>

    $(document).ready(function(){
        loadRefrence();
    });

     async function loadRefrence() {
       
        $.ajax({
            type: 'POST',
            url: '@baseUrl/ManpowerRequisitionAPI/GetAllSerialNo',
            data: JSON.stringify({ CompanyId: CompanyId }), // Ensure CompanyId is defined
            contentType: 'application/json',
            headers: {
                'Authorization': 'Bearer ' + Token // Ensure Token is defined
            },
            success: function(response) {
                if (response.isSuccess) {
                    bindSerial(response.data);
                } 
            },
            error: function(xhr, status, error) {
                console.error("AJAX Error:", status, error);
            }
        });
    }


     function bindSerial(data)
     {
            $('#referenceNo').searchableSelect({
              data: data||[],
                valueKey: 'manpowerRequisitionId',
                textKey: 'serialNo',
                placeholder:'Reference',
                searchPlaceholder: 'Search reference...',
              onChange: function(item) {
                  loadManpowerDetails(item.manpowerRequisitionId);
                  ManpowerRelationDataTable();
                    ManpowerDocumentDataTable();

              }
          });
     }

     async function loadManpowerDetails(Id) {
       
        $.ajax({
            type: 'GET',
            url: '@baseUrl/ManpowerRequisitionAPI/GetManpowerRequisitionByManpowerRequisitionId/'+Id,
            headers: {
                'Authorization': 'Bearer ' + Token // Ensure Token is defined
            },
            success: function(response) {
                if (response.isSuccess) {
                   populateFormWithApiData(response.data);
                } 
            },
            error: function(xhr, status, error) {
                console.error("AJAX Error:", status, error);
            }
        });
    }

        function populateFormWithApiData(apiData) {
            // Employee Info Tab
            $('#operationType').val(apiData.OperationType || '');

            // Set the display value for the searchable select
            if (apiData.SerialNo) {
                $('#referenceNo').data('searchableSelect').setValue(apiData.SerialNo);
            }

            $('#employeeName').val(apiData.EmployeeName || '');
            $('#employeeEmail').val(apiData.PersonalEmail || '');
            $('#presentAddress').val(apiData.PresentAddress || '');
            $('#permanentAddress').val(apiData.PermanentAddress || '');
            $('#lastEducation').val(apiData.EducationalQualification || '');
            $('#maritalStatus').val(apiData.MaritalStatus || '');

            if (apiData.DateOfBirth) {
                const dateOfBirth = new Date(apiData.DateOfBirth);
                const formattedBirthDate = dateOfBirth.toISOString().split('T')[0];
                $('#dateOfBirth').val(formattedBirthDate);
            }

            $('#totalExperience').val(apiData.ExperienceRange || '');
            $('#mobileNo').val(apiData.ContactNumber || '');
            $('#bloodGroup').val(apiData.BloodGroup || '');

            // Joining Details Tab
            $('#branchName').val(apiData.BranchName || '');
            $('#reportingTo').val(apiData.ReportingName || '');
            $('#department').val(apiData.DepartmentName || '');
            $('#designation').val(apiData.DesignationName || '');

            if (apiData.DateOfJoining) {
                const dateOfJoining = new Date(apiData.DateOfJoining);
                const formattedJoinDate = dateOfJoining.toISOString().split('T')[0];
                $('#dateOfJoining').val(formattedJoinDate);
            }

            $('#interviewedBy').val(apiData.InterviewedBy || '');

            if (apiData.InterviewDate) {
                const dateOfInterview = new Date(apiData.InterviewDate);
                const formattedInterviewDate = dateOfInterview.toISOString().split('T')[0];
                $('#interviewDate').val(formattedInterviewDate);
            }

            $('#interviewPlace').val(apiData.InterviewPlace || '');
            $('#clientName').val(apiData.ClientName || '');
            $('#erpCode').val(apiData.ErpCode || '');
            $('#previousCompanyUAN').val(apiData.PreviousCompanyUAN || '');
            $('#previousCompanyESIC').val(apiData.PreviousCompanyESIC || '');

            // Salary Details Tab
            $('#grossSalary').val(apiData.GrossSalary || '');
            $('#netSalary').val(apiData.TakeHomeSalary || '');
            $('#esicNo').val(apiData.EsicNo || '');
            $('#pfUAN').val(apiData.PFUAN || '');
            $('#pan').val(apiData.Pan || '');
        }

//employee info
     async function getFormData() {
        const formData = {
            Action:"UPDATE_EmployeeInfo",
             ManpowerRequisitionId: $('#referenceNo').data('searchableSelect').getValue() || null,
            operationType: $('#operationType').val() || null,
            employeeName: $('#employeeName').val() || null,
            employeeEmail: $('#employeeEmail').val() || null,
            presentAddress: $('#presentAddress').val() || null,
            permanentAddress: $('#permanentAddress').val() || null,
            lastEducation: $('#lastEducation').val() || null,
            maritalStatus: $('#maritalStatus').val() || null,
            dateOfBirth: $('#dateOfBirth').val() || null,
            totalExperience: $('#totalExperience').val() || null,
            mobileNo: $('#mobileNo').val() || null,
            bloodGroup: $('#bloodGroup').val() || null
        };
        return formData;
    }

    $("#btnEmployeeInfo").click(async ()=>
    {
           $(".btn-save").prop("disabled",true);
         let isValid = true;

        // Reset all error messages
        $('.error-message').hide();

        // Reference No validation
        const referenceNo = $('#referenceNo').data('searchableSelect').getValue();
        if (!referenceNo) {
            $('#errorReference').show();
            isValid = false;
        }
        if(!isValid){
            $(".btn-save").prop("disabled",false);
            return;
        }
        const formData = await getFormData();
        
        $.ajax({
            url: '@baseUrl/ManpowerRequisitionAPI/UpdateJoinningDetails',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(formData),
            success: function(response) {
                if(response.isSuccess)
                {
                    round_success_noti(response.responseMessage);
                    loadManpowerDetails(referenceNo);
                }
                else
                {
                    round_error_noti(response.responseMessage)
                }
                 $(".btn-save").prop("disabled",false);

            },
            error: function(xhr, status, error) {
                   $(".btn-save").prop("disabled",false);

                console.log('Error saving data: ' + error);
            }
        });
    });

    //joining

     async function getJoiningFormData() {
        const formJoinData = {
            Action:"UPDATE_JoiningDetails",
             ManpowerRequisitionId: $('#referenceNo').data('searchableSelect').getValue() || null,
            branchName: $('#branchName').val() || null,
            reportingTo: $('#reportingTo').val() || null,
            department: $('#department').val() || null,
            designation: $('#designation').val() || null,
            interviewedBy: $('#interviewedBy').val() || null,
            interviewDate: $('#interviewDate').val() || null,
            dateOfJoining: $('#dateOfJoining').val() || null,
            interviewPlace: $('#interviewPlace').val() || null,
            clientName: $('#clientName').val() || null,
            erpCode: $('#erpCode').val() || null,
            previousCompanyUAN: $('#previousCompanyUAN').val() || null,
            previousCompanyESIC: $('#previousCompanyESIC').val() || null
        };
        return formJoinData;
    }

    $("#btnJoiningDetails").click(async ()=>
    {
         $(".btn-save").prop("disabled",true);

         let isValid = true;

        // Reset all error messages
        $('.error-message').hide();

        // Reference No validation
        const referenceNo = $('#referenceNo').data('searchableSelect').getValue();
        if (!referenceNo) {
             round_error_noti("Please select reference no");
            $('#errorReference').show();
            isValid = false;
        }
        if(!isValid){
              $(".btn-save").prop("disabled",false);
            return;
        }
        const formJoiningData = await getJoiningFormData();
       
        $.ajax({
            url: '@baseUrl/ManpowerRequisitionAPI/UpdateJoinningDetails',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(formJoiningData),
            success: function(response) {
                if(response.isSuccess)
                {
                    round_success_noti(response.responseMessage);
                    loadManpowerDetails(referenceNo);
                }
                else
                {
                    round_error_noti(response.responseMessage)
                }
                         $(".btn-save").prop("disabled",false);
            },
            error: function(xhr, status, error) {
                         $(".btn-save").prop("disabled",false);
                console.log('Error saving data: ' + error);
            }
        });
    });



    //Salary

    async function getSalaryFormData() {
        const formSalaryData = {
            Action: "UPDATE_SalaryDetails",
             ManpowerRequisitionId: $('#referenceNo').data('searchableSelect').getValue() || null,
            PFUAN: $('#pfUAN').val() || null,
            ESICNo: $('#esicNo').val() || null,
            PAN: $('#pan').val() || null,
            GrossSalary: parseFloat($('#grossSalary').val().replace(/[^0-9.-]/g, '')) || null,
            NetSalary: parseFloat($('#netSalary').val().replace(/[^0-9.-]/g, '')) || null
        };
        return formSalaryData;
    }

    $("#btnSalary").click(async () => {
           $(".btn-save").prop("disabled",true);
        let isValid = true;
        // Reset all error messages
        $('.error-message').hide();
        // Reference No validation
        const referenceNo = $('#referenceNo').data('searchableSelect').getValue();
        if (!referenceNo) {
             round_error_noti("Please select reference no");
            $('#errorReference').show();
            isValid = false;
        }
        // PF UAN validation
        const pfUAN = $('#pfUAN').val();
        if (!pfUAN) {
               $('#errorpfuan').show();
            isValid = false;
        }

        // ESIC No validation
        const esicNo = $('#esicNo').val();
        if (!esicNo) {
                    $('#errorESICNo').show();
            isValid = false;
        }

        // PAN validation
        const pan = $('#pan').val();
        if (!pan) {
            $('#errorPanPAN').show();
            isValid = false;
        }

        if (!isValid) {
               $(".btn-save").prop("disabled",false);
            return;
        }

        const formSalaryData = await getSalaryFormData();
        $.ajax({
            url: '@baseUrl/ManpowerRequisitionAPI/UpdateJoinningDetails',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(formSalaryData),
            success: function(response) {
                if (response.isSuccess) {
                    round_success_noti(response.responseMessage);
                    // Optionally, reload or redirect after success
                } else {
                    round_error_noti(response.responseMessage);
                }
                   $(".btn-save").prop("disabled",false);

            },
            error: function(xhr, status, error) {
                console.log('Error saving data: ' + error);
                 $(".btn-save").prop("disabled",false);


            }
        });
    });

    //Attachment

    $(document).ready(function(){
        loadDocumentType();
    });
   

     async function loadDocumentType() {
        try {
            const response = await $.ajax({
                url: '@baseUrl/AttachmentDetailsAPI/GetAllDocumentTypes',
                method: 'GET'
            });
            $('#documentName').searchableSelect({
                data: response.data || [],
                valueKey: 'documentTypeId',
                textKey: 'documentName',
                placeholder: 'Document',
                searchPlaceholder: 'Search document...',
                onChange: function(item) {
                    // Handle selection change
                }
            });
        } catch (error) {
            console.error('Error fetching data:', error);
        }
    }


       let selectedManpowerAttachmentId=null;
     $("#btnDocument").click(function () {
        $(".btn-save").prop("disabled",true);
        if (ValidateDocumentForm()) {
            SaveManpowerDocument();
              $(".btn-save").prop("disabled",false);
        }
        else{
              $(".btn-save").prop("disabled",false);
        }
    });

    // Validate form
    function ValidateDocumentForm() {
        let isValid = true;
        const documentName = $("#documentName").data('searchableSelect').getValue();
        const documentFile = $("#document")[0].files[0];
        const manpowerRequisitionId = $('#referenceNo').data('searchableSelect').getValue();
        if (!manpowerRequisitionId) {
            round_error_noti("Please select a reference no");
            return false;
        }
        if (!documentName) {
            $("#errorDocument").show();
            isValid = false;
        } else {
            $("#errorDocument").hide();
        }

        if (!documentFile && !selectedManpowerAttachmentId) { // Only require file for new uploads
            round_error_noti("Please upload a document");
            isValid = false;
        }

        return isValid;
    }

    // Save or update manpower document
    function SaveManpowerDocument() {
           const formData = new FormData();
            const documentFile = $("#document")[0].files[0];

            // Append each field individually
            formData.append("ManpowerAttachmentId", selectedManpowerAttachmentId || "");
            formData.append("ManpowerRequisitionId", $('#referenceNo').data('searchableSelect').getValue() || "");
            formData.append("DocumentTypeId", $('#documentName').data('searchableSelect').getValue() || "");
            formData.append("Comment", $("#comment").val().trim() || "");
            formData.append("DateOfExpiry", $("#dateOfExpiry").val() || "");
            formData.append("CreatedBy", EmployeeId || "");
            formData.append("UpdatedBy", EmployeeId || "");

            // Append the file if it exists
            if (documentFile) {
                formData.append("DocumentFile", documentFile);
            }

        const url = selectedManpowerAttachmentId
            ? '@baseUrl/ManpowerAttachmentAPI/Update'
            : '@baseUrl/ManpowerAttachmentAPI/Create';

        $.ajax({
            type: "POST",
            url: url,
            headers: { 'Authorization': 'Bearer ' + Token },
            contentType: false,
            processData: false,
            data: formData,
            success: function (response) {
                if (response.isSuccess) {
                    round_success_noti(response.responseMessage);
                    ResetDocumentForm();
                    ManpowerDocumentDataTable();
                } else {
                    round_error_noti(response.responseMessage);
                }
            },
            error: function (xhr, status, error) {
                round_error_noti("Unable to save document. Please try again later.");
            }
        });
    }

    // Reset form
    function ResetDocumentForm() {
        $("#document-details form")[0].reset();
        selectedManpowerAttachmentId = null;
        $("#documentName").data('searchableSelect').clear();
        $(".error-message").hide();
    }



     function ManpowerDocumentDataTable() {
        const manpowerRequisitionId = $('#referenceNo').data('searchableSelect').getValue();
        if (!manpowerRequisitionId) {
            round_error_noti("Please select a reference no");
            return;
        }

        $('#grid-loader').addClass('d-flex').show();
        $.ajax({
            type: "GET",
            url: '@baseUrl/ManpowerAttachmentAPI/GetAll/' + manpowerRequisitionId,
            headers: { 'Authorization': 'Bearer ' + Token },
            success: function (data) {
                $("#GridDocumentContainer").dxDataGrid({
                    dataSource: data.data || [],
                    columns: [
                                { dataField: 'DocumentName', caption: 'Document Name', alignment: 'left' },
                        { dataField: 'DocumentUrl', caption: 'Document', alignment: 'left', cellTemplate: function(container, options) {
                            $('<a>').attr('href', options.value).attr('target', '_blank').text('View Document').appendTo(container);
                        }},
                        { dataField: 'DateOfExpiry', caption: 'Expiry Date', alignment: 'left', dataType: 'date',formate:'dd-MM-yyyy' },
                        { dataField: 'Comment', caption: 'Comment', alignment: 'left' },
                        {
                            dataField: '',
                            caption: '',
                            alignment: 'center',
                            width: '50px',
                            cellTemplate: function(container, options) {
                                $('<div>').addClass('d-flex order-actions')
                                    .append(
                                        $('<a>').attr('href', 'javascript:;')
                                            .addClass('edit-action')
                                            .html('<svg xmlns="http://www.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16"><path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456l-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/><path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"/></svg>')
                                            .on('click', function() { UpdateManpowerDocument(options.data); })
                                    )
                                    .appendTo(container);
                            }
                        },
                        {
                            dataField: '',
                            caption: '',
                            alignment: 'center',
                            width: '50px',
                            cellTemplate: function(container, options) {
                                $('<div>').addClass('d-flex order-actions')
                                    .append(
                                        $('<a>').attr('href', 'javascript:;')
                                            .addClass('delete-action')
                                            .html('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash-fill" viewBox="0 0 16 16"><path d="M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5M8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7A.5.5 0 0 1 8 5m3 .5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 1 0"/></svg>')
                                            .on('click', function() { DeleteManpowerDocument(options.data.ManpowerAttachmentId); })
                                    )
                                    .appendTo(container);
                            }
                        }
                    ],
                columnsAutoWidth: true,
                wordWrapEnabled: false,
                rowAlternationEnabled: false,
                showBorders: true,
                paging: { pageSize: 10 },
                pager: { showPageSizeSelector: true, allowedPageSizes: [10, 25, 50, 100] },
                headerFilter: { visible: false },
                filterRow: { visible: false, applyFilter: "auto" },
                allowColumnResizing: false,
                groupPanel: { visible: false },
                searchPanel: { visible: true, width: 240, placeholder: "Search..." },
                onContentReady: function (e) {
                            $('#rowCountDocument').html('Total Records: ' + e.component.totalCount());
                }               
                
            });
                $('#grid-loader').removeClass('d-flex').hide();
            },
            error: function(xhr, status, error) {
                $('#grid-loader').removeClass('d-flex').hide();
                console.error("AJAX Error: " + status + " - " + error);
            }
        });
    }

    function UpdateManpowerDocument(data) {
        ResetDocumentForm();
        selectedManpowerAttachmentId = data.ManpowerAttachmentId;
        $("#documentName").data('searchableSelect').setValue(data.DocumentTypeId);
          $("#dateOfExpiry").val(data.DateOfExpiry.split('T')[0]);
        $("#comment").val(data.Comment);
    }


     function DeleteManpowerDocument(manpowerAttachmentId) {
        if (confirm("Are you sure you want to delete this document?")) {
            $.ajax({
                type: "DELETE",
                url: '@baseUrl/ManpowerAttachmentAPI/Delete',
                headers: { 'Authorization': 'Bearer ' + Token },
                contentType: "application/json",
                data: JSON.stringify({ Id: manpowerAttachmentId, DeletedBy: EmployeeId }),
                success: function(response) {
                    if (response.isSuccess) {
                        round_success_noti(response.responseMessage);
                        ManpowerDocumentDataTable();
                    } else {
                        round_error_noti(response.responseMessage);
                    }
                },
                error: function(xhr, status, error) {
                    round_error_noti("Unable to delete document. Please try again later.");
                }
            });
        }
    }



    //Relation

    var selectedManpowerRelationId=null;
    $(document).ready(function(){
        loadBindRelationShiptOption();
    });

     async function loadBindRelationShiptOption() {

        try {
            const response = await fetch('@baseUrl/RelationShipAPI/GetAllRelationShips', {
                method: 'GET',
                headers: {
                    'Accept': 'application/json'
                }
            });

            const data = await response.json();

                if (data.isSuccess) {
                    $('#contactPersonRelation').searchableSelect({
                  data: data.data||[],
                    valueKey: 'relationShipId',
                    textKey: 'relationName',
                    placeholder:'Relation',
                    searchPlaceholder: 'Search relation...',
                  onChange: function(item) {
                  }
              });
            }
        } catch (error) {
            console.error('Fetch error:', error);
        }
    }
       

    $("#btnRelation").click(function () {
                    $(".btn-save").prop("disabled",true);
            if (ValidateForm()) {
                SaveManpowerRelation();
                         $(".btn-save").prop("disabled",false);
            }
            else{
                $(".btn-save").prop("disabled",false);
             }
    });

     // Validate form
    function ValidateForm() {
        let isValid = true;
        const name = $("#contactPersonName").val().trim();
        const mobile = $("#contactMobileNo").val().trim();
        const contactPersonRelation = $("#contactPersonRelation").data('searchableSelect').getValue();
          // Reference No validation
        const referenceNo = $('#referenceNo').data('searchableSelect').getValue();
        if (!referenceNo) {
             round_error_noti("Please select reference no");
            $('#errorReference').show();
            isValid = false;
        }

        if (!name) {
            $("#errorName").show();
            isValid = false;
        } else {
            $("#errorName").hide();
        }

        if (!contactPersonRelation) {
            $("#errorRelaioin").show();
            isValid = false;
        } else {
            $("#errorRelaioin").hide();
        }

        if (!mobile || !/^[0-9]{10}$/.test(mobile)) {
            $("#errorMobile").show();
            isValid = false;
        } else {
            $("#errorMobile").hide();
        }

        return isValid;
    }

    // Save manpower relation
    function SaveManpowerRelation() {
        const model = {
            ManpowerRelationId: selectedManpowerRelationId,
            Name: $("#contactPersonName").val().trim(),
            ManpowerRequisitionId: $('#referenceNo').data('searchableSelect').getValue(),
            RelationShipId: $('#contactPersonRelation').data('searchableSelect').getValue(),
            MobileNo: $("#contactMobileNo").val().trim(),
            CreatedBy: EmployeeId,
           UpdatedBy: EmployeeId 
        };

        const url = selectedManpowerRelationId
            ? '@baseUrl/ManpowerRelationAPI/Update'
            : '@baseUrl/ManpowerRelationAPI/Create';

        const method = selectedManpowerRelationId ? "POST" : "POST";

        $.ajax({
            type: method,
            url: url,
            headers: { 'Authorization': 'Bearer ' + Token },
            contentType: "application/json",
            data: JSON.stringify(model),
                success: function (response) {
                   if (response.responseMessage) {
                        round_success_noti(response.responseMessage);
                           ResetForm();
                           ManpowerRelationDataTable();
                    } else {
                        round_error_noti(response.responseMessage);
                    }
            },
            error: function (xhr, status, error) {
                round_error_noti("Unable to save relation. Please try again later.");
            }
        });
    }

    // Reset form
    function ResetForm() {
        $("#manpowerRelationForm")[0].reset();
        selectedManpowerRelationId = null;
        $("#contactPersonRelation").data('searchableSelect').clear();
        $(".error-message").hide();
    }

    // Load manpower relations in DevExtreme DataGrid
    function ManpowerRelationDataTable() {
        const manpowerRequisitionId = $('#referenceNo').data('searchableSelect').getValue();
        if (!referenceNo) {
             round_error_noti("Please select reference no");
            $('#errorReference').show();
            return;
        }
        $('#grid-loader').addClass('d-flex').show();
        $.ajax({
            type: "GET",
            url: '@baseUrl/ManpowerRelationAPI/GetAll/'+manpowerRequisitionId,
            headers: { 'Authorization': 'Bearer ' + Token },
            success: function (data) {
             
                    $("#GridRelationContainer").dxDataGrid({
                        dataSource: data.data||[],
                        columns: [
                            { dataField: 'Name', caption: 'Contact Person Name', alignment: 'left' },
                            {
                                dataField: 'RelationName',
                                caption: 'Relationship',
                                alignment: 'left'
                               
                            },
                            { dataField: 'MobileNo', caption: 'Mobile No.', alignment: 'left' },
                            {
                                dataField: '',
                                caption: '',
                                alignment: 'center',
                                width: '50px',
                                cellTemplate: function (container, options) {
                                    $('<div class="d-flex order-actions">')
                                        .append(
                                            $('<a>').attr('href', 'javascript:;')
                                                .addClass('edit-action')
                                                .attr('title', 'Edit Relation')
                                                .html('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16"><path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456l-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/><path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"/></svg>')
                                                .on('dxclick', function () {
                                                    UpdateManpowerRelation(options.data);
                                                })
                                        )
                                        .appendTo(container);
                                }
                            },
                            {
                                dataField: '',
                                caption: '',
                                alignment: 'center',
                                width: '50px',
                                cellTemplate: function (container, options) {
                                    $('<div class="d-flex order-actions">')
                                        .append(
                                            $('<a>').attr('href', 'javascript:;')
                                                .addClass('delete-action')
                                                .attr('title', 'Delete Relation')
                                                .html('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash-fill" viewBox="0 0 16 16"><path d="M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5M8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7A.5.5 0 0 1 8 5m3 .5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 1 0"/></svg>')
                                                .on('dxclick', function () {
                                                    DeleteManpowerRelation(options.data.ManpowerRelationId);
                                                })
                                        )
                                        .appendTo(container);
                                }
                            }
                        ],
                        columnsAutoWidth: true,
                        wordWrapEnabled: false,
                        rowAlternationEnabled: false,
                        showBorders: true,
                        paging: { pageSize: 10 },
                        pager: { showPageSizeSelector: true, allowedPageSizes: [10, 25, 50, 100] },
                        headerFilter: { visible: false },
                        filterRow: { visible: false, applyFilter: "auto" },
                        allowColumnResizing: false,
                        groupPanel: { visible: false },
                        searchPanel: { visible: true, width: 240, placeholder: "Search..." },
                        onContentReady: function (e) {
                            $('#rowCountRelation').html('Total Records: ' + e.component.totalCount());
                        }
                    });
               
                $('#grid-loader').removeClass('d-flex').hide();
            },
            error: function (xhr, status, error) {
                $('#grid-loader').removeClass('d-flex').hide();
                console.error("AJAX Error: " + status + " - " + error);
            }
        });
    }

    // Update manpower relation
    function UpdateManpowerRelation(data) {
                    ResetForm();
        selectedManpowerRelationId = data.ManpowerRelationId;
        $("#contactPersonName").val(data.Name);
        $("#contactPersonRelation").data('searchableSelect').setValue(data.RelationShipId);
        //$("#referenceNo").data('searchableSelect').setValue(data.ManpowerRequisitionId);
        $("#contactMobileNo").val(data.MobileNo);
    }

    // Delete manpower relation
    function DeleteManpowerRelation(manpowerRelationId) {
              if(confirm("Are you sure you want to delete this relation?"))
              {
                    $.ajax({
                        type: "DELETE",
                        url: '@baseUrl/ManpowerRelationAPI/Delete',
                        headers: { 'Authorization': 'Bearer ' + Token },
                        contentType: "application/json",
                        data: JSON.stringify({ Id: manpowerRelationId, DeletedBy: EmployeeId }),
                            success: function (response) {
                                if (response.isSuccess) {
                                    round_success_noti(response.responseMessage);
                                       ManpowerRelationDataTable();
                                } else {
                                    round_error_noti(response.responseMessage);
                                }
                        },
                        error: function (xhr, status, error) {
                                round_error_noti("Unable to delete relation. Please try again later.");
                        }
                    });
              }
           
    }

   
</script>