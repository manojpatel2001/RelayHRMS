@inject IConfiguration Configuration
@{
	ViewData["Title"] = "Employee Master";
	Layout = "~/Areas/AdminPanel/Views/Shared/_AdminLayout.cshtml";
	string baseUrl = Configuration["BaseUrlSettings:baseUrl"];
	string UIBaseUrlLayout = Configuration["UIBaseUrlSettings:baseUrl"];
	var uriAPI = new Uri(baseUrl);
	string baseAPIDomainUrl = $"{uriAPI.Scheme}://{uriAPI.Host}:{uriAPI.Port}";
}
<style>
	.custom-radio {
		display: inline-block;
		cursor: pointer;
	}

	.custom-label {
		display: inline-block;
		margin: 0.5rem;
		cursor: pointer;
		transition: all 0.3s ease;
	}

	.custom-radio:checked + .custom-label {
		color: blue;
	}

	#EmployeeFilter{
		border:2px solid black;
	}

	/* Tooltip button styles */
	.tooltip-button {
		background-color: blue;
		color: white;
		border-radius: 50%;
		width: 24px;
		height: 24px;
		display: flex;
		align-items: center;
		justify-content: center;
		cursor: pointer;
		position: absolute;
		right: 10px;
		top: 50%;
		transform: translateY(-50%);
	}

	/* Tooltip styles */
	.tooltip-text {
		display: none;
		position: absolute;
		background-color: #ffffe0;
		border: 1px solid #ccc;
		padding: 10px;
		box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
		z-index: 1000;
		width: 250px;
		top: 0;
		right: 30px;
	}

		.tooltip-button:hover + .tooltip-text,
		.tooltip-text:hover {
			display: block;
		}

	
	.input-icon-right {
  position: absolute;
  top: 50%;
  right: 12px;
  transform: translateY(-50%);
  color: #6c757d;
  font-size: 1rem;
  pointer-events: none;
}

	#gridToolbar {
		display: none !important;
	}

</style>

<style>
	

	.title {
		text-align: center;
		margin-bottom: 2rem;
		color: #2d3748;
		font-size: 1.5rem;
		font-weight: 600;
	}

	.button-group {
		display: flex;
		flex-wrap: nowrap;
		gap: 5px;
		justify-content: center;
		margin-bottom: 2rem;
	}

	.radio-button {
		position: relative;
		flex: 1;
		min-width: 100px;
	}

		.radio-button input[type="radio"] {
			position: absolute;
			opacity: 0;
			max-width: 100%;
			max-height: 100%;
			margin: 0;
			cursor: pointer;
		}

		.radio-button label {
			display: block;
			padding: 3px 3px;
			background: #f7fafc;
			border: 2px solid #e2e8f0;
			border-radius: 12px;
			text-align: center;
			font-weight: 500;
			color: #4a5568;
			cursor: pointer;
			transition: all 0.3s ease;
			position: relative;
			overflow: hidden;
			white-space: nowrap;
		}

			.radio-button label:before {
				content: '';
				position: absolute;
				top: 0;
				left: -100%;
				width: 100%;
				height: 100%;
				background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
				transition: left 0.5s ease;
			}

		.radio-button:hover label {
			transform: translateY(-2px);
			box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
			border-color: #cbd5e0;
		}

			.radio-button:hover label:before {
				left: 100%;
			}

		.radio-button input[type="radio"]:checked + label {
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			border-color: #667eea;
			color: white;
			transform: translateY(-2px);
			box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
		}

			.radio-button input[type="radio"]:checked + label:after {
				content: '✓';
				position: absolute;
				top: 1px;
				right: 8px;
				font-size: 16px;
				font-weight: bold;
				animation: checkmark 0.3s ease-in-out;
			}

	@@keyframes checkmark {
		0%

	{
		transform: scale(0) rotate(180deg);
		opacity: 0;
	}

	100% {
		transform: scale(1) rotate(0deg);
		opacity: 1;
	}

	}

	.selected-value {
		text-align: center;
		padding: 1rem;
		background: #f0f9ff;
		border-radius: 8px;
		border-left: 4px solid #667eea;
		color: #1e40af;
		font-weight: 500;
	}

	/* Responsive Design */
	@@media (max-width: 768px) {
		.container

	{
		padding: 1.5rem;
		margin: 10px;
	}

	.button-group {
		flex-direction: column;
		flex-wrap: wrap;
		gap: 5px;
	}

	.radio-button {
		min-width: auto;
	}

		.radio-button label {
			padding: 5px 16px;
		}

	.title {
		font-size: 1.25rem;
		margin-bottom: 1.5rem;
	}

	}

	@@media (max-width: 480px) {
		.container

	{
		padding: 1rem;
	}

	.radio-button label {
		padding: 5px 12px;
		font-size: 0.9rem;
		white-space: normal;
		word-break: break-word;
	}

	}

	/* Alternative compact layout for smaller screens */
	@@media (max-width: 600px) {
		.button-group

	{
		display: grid;
		grid-template-columns: 1fr;
		gap: 5px;
	}

	}

	/* For very large screens */
	@@media (min-width: 1200px) {
		.button-group

	{
		gap: 5px;
	}

	.radio-button {
		min-width: 100px;
	}

	}
</style>

<div class="card ">
	<div class="card-header bg-transparent ml-0 py-0">
		<div class="row ">
			<div class="col-6 ">
				<h6 class="mt-2 mb-0">
					Employee Master
				</h6>
			</div>

			<div class="col-6 d-flex justify-content-end align-items-center">
			

                <button id="addEmployee"
						type="button"
						class="btn mr-1 rounded-1 "
						style="background-color:#2395c6; color:white;">
					Add Employee
				</button>

			</div>
		</div>
	</div>
	<div class="card-body">
  

		<div class="row">
			<div class="col-sm-4">

				<div class="button-group">
					<div class="radio-button">
						<input type="radio" name="options" id="allEmployee" value="AllEmployee" checked>
						<label for="allEmployee">All Employee</label>
					</div>

					<div class="radio-button">
						<input type="radio" name="options" id="leftEmployee" value="LeftEmployee">
						<label for="leftEmployee">Left Employee</label>
					</div>

					<div class="radio-button">
						<input type="radio" name="options" id="currentEmployee" value="CurrentEmployee">
						<label for="currentEmployee">Current Employee</label>
					</div>
				</div>
			</div>
		</div>
			
		


    <div class="row">
        <div class="col-md-12 ">
            <div class="form-group gridTag">
					
					<div class="grid-wrapper " style="position: relative; ">
						<div id="grid-loader" class="grid-loader justify-content-center align-items-center flex-column "
							 style="display: none;  inset: 0; background: rgba(255,255,255,0.6); z-index: 10; ">
							<img src="@baseAPIDomainUrl/loders/loder.png" class="grid-logo-spinner" style="width: 30px; height: 30px; animation: spin 1s linear infinite;" />
							<div class="grid-loading-text text-dark" style="font-size: 16px;">Loading...</div>

						</div>
						<div class="rowCount" id="rowCountEmployee"></div>

						<div class="grid-toolbar d-flex justify-content-end align-items-center gap-2 mb-2" style="display: none;" id="gridToolbar">
							<div id="gridSearchBox" style="width: 240px;"></div>
							<button class="export-btn btn btn-primary d-flex align-items-center gap-1" id="btnExport" onclick="openExportModal('Employee Master')">
								<svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
									<path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z" />
								</svg>
								Export to Excel
							</button>
							<button class="export-btn btn btn-primary d-flex align-items-center gap-1" id="btnExporting" disabled style="display:none !important;">
								<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
								Exporting...
							</button>


						</div>



						<div id="gridAllContainerEmployee" class="gridContainer"></div>
						<div id="gridLeftContainerEmployee" style="display:none;"></div>
						<div id="gridCurrentContainerEmployee" style="display:none;"></div>
					</div>


					
            </div>
			<div id="spnNoRecord" style="display:none;">No Record Found!</div>
        </div>
    </div>
</div>

</div>


<div class="modal fade" id="addEmployeeModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
	<div class="modal-dialog modal-xl">
		<div class="modal-content">
			<div class="modal-header">
				<h6 class="modal-title btn-heading-title"><span class="formType">Add</span> Employee Details</h6>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body modal-body-font" style="font-size:12px;">
				<form id="employeeForm">
					<div class="row">
						
						<div class="col-md-4">
							<div class="mt-3 form-floating-custom">
								<div class="searchable-select-wrapper" id="initialWrapper">
									<label for="ddlInitial">Initial <span class="text-danger">*</span></label>
									<input type="text" class="searchable-select-input" id="ddlInitial" readonly>
									<span class="searchable-select-arrow">
										<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
											<path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z" />
										</svg>
									</span>
									<div class="searchable-select-dropdown">
										<div class="searchable-select-search">
											<input type="text" placeholder="Search initial..." class="search-input">
										</div>
										<div class="searchable-select-options"></div>
									</div>
								</div>
								<span id="spnInitial" style="color:red; display:none;">Please Select Initial</span>
							</div>
						</div>

						<div class="col-md-4">
							<div class="form-group mt-3 position-relative">
								<input type="text" class="form-control floating-input" id="txtFirstName" placeholder="First Name">
								<label class="floating-label" for="txtFirstName">First Name<span class="required-star">*</span></label>
							</div>
							<span id="spnFirstName" style="color:red; display:none;">Please Enter First Name</span>
						</div>
						<div class="col-md-4">
							<div class="form-group mt-3 position-relative">
								<input type="text" class="form-control floating-input" id="txtMiddleName" placeholder="Middle Name">
								<label class="floating-label" for="txtMiddleName">Middle Name</label>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-md-4">
							<div class="form-group mt-3 position-relative">
								<input type="text" class="form-control floating-input" id="txtLastName" placeholder="Last Name">
								<label class="floating-label" for="txtLastName">Last Name</label>
							</div>
						</div>
						<div class="col-md-4">
							<div class="row">
								<div class="col-md-4">
									<div class="form-group mt-3 position-relative">
										Employee Code<span class="required-star">*</span>:
									</div>
								</div>
								<div class="col-md-4 p-0" id="tagtxtEmpCode" style="display:none;">
									<div class="form-group mt-3 position-relative">
										<input type="text" class="form-control floating-input" readonly id="txtEmpCode" placeholder="HRMS" value="">
									</div>
								</div>
								<div class="col-md-4">
									<div class="form-group mt-3 position-relative">
										<input type="text" class="form-control floating-input" id="txtNumberEmpCode" placeholder="0001" value="">
									</div>
								</div>
								<span id="spnStringCode" style="color:red; display:none;">Please Enter String Code</span>
								<span id="spnNumberCode" style="color:red; display:none;">Please Enter Employee Code</span>
							</div>
						</div>
						<div class="col-md-4">
							<div class="form-group mt-3 position-relative">
								<input type="date" class="form-control floating-input" id="doj" placeholder=" ">
								<label class="floating-label" for="doj">Date of Joining<span class="required-star">*</span></label>
							</div>
							<span id="spnDoj" style="color:red; display:none;">Please Select Date Of Joining</span>
						</div>
					</div>
					<div class="row">
						<!-- Updated Branch Select -->
						<div class="col-md-4">
							<div class="mt-3 form-floating-custom">
								<div class="searchable-select-wrapper" id="branchWrapper">
									<label for="ddlBranch">Branch <span class="text-danger">*</span></label>
									<input type="text" class="searchable-select-input" id="ddlBranch" readonly>
									<span class="searchable-select-arrow">
										<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
											<path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z" />
										</svg>
									</span>
									<div class="searchable-select-dropdown">
										<div class="searchable-select-search">
											<input type="text" placeholder="Search branch..." class="search-input">
										</div>
										<div class="searchable-select-options"></div>
									</div>
								</div>
								<span id="spnBranch" style="color:red; display:none;">Please Select Branch</span>
							</div>
						</div>

						<!-- Updated Grade Select -->
						<div class="col-md-4">
							<div class="mt-3 form-floating-custom">
								<div class="searchable-select-wrapper" id="gradeWrapper">
									<label for="ddlGrade">Grade <span class="text-danger">*</span></label>
									<input type="text" class="searchable-select-input" id="ddlGrade" readonly disabled>
									<span class="searchable-select-arrow">
										<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
											<path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z" />
										</svg>
									</span>
									<div class="searchable-select-dropdown">
										<div class="searchable-select-search">
											<input type="text" placeholder="Search grade..." class="search-input">
										</div>
										<div class="searchable-select-options"></div>
									</div>
								</div>
								<span id="spnGrade" style="color:red; display:none;">Please Select Grade</span>
							</div>
						</div>

						<!-- Updated Shift Select -->
						<div class="col-md-4">
							<div class="mt-3 form-floating-custom">
								<div class="searchable-select-wrapper" id="shiftWrapper">
									<label for="ddlShift">Shift <span class="text-danger">*</span></label>
									<input type="text" class="searchable-select-input" id="ddlShift" readonly>
									<span class="searchable-select-arrow">
										<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
											<path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z" />
										</svg>
									</span>
									<div class="searchable-select-dropdown">
										<div class="searchable-select-search">
											<input type="text" placeholder="Search shift..." class="search-input">
										</div>
										<div class="searchable-select-options"></div>
									</div>
								</div>
								<span id="spnShift" style="color:red; display:none;">Please Select Shift</span>
							</div>
						</div>
					</div>

					<div class="row">
						<!-- Updated Designation Select -->
						<div class="col-md-4">
							<div class="mt-3 form-floating-custom">
								<div class="searchable-select-wrapper" id="designationWrapper">
									<label for="ddlDesignation">Designation <span class="text-danger">*</span></label>
									<input type="text" class="searchable-select-input" id="ddlDesignation" readonly>
									<span class="searchable-select-arrow">
										<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
											<path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z" />
										</svg>
									</span>
									<div class="searchable-select-dropdown">
										<div class="searchable-select-search">
											<input type="text" placeholder="Search designation..." class="search-input">
										</div>
										<div class="searchable-select-options"></div>
									</div>
								</div>
								<span id="spnDesignation" style="color:red; display:none;">Please Select Designation</span>
							</div>
						</div>

						<div class="col-md-4">
							<div class="form-group mt-3 position-relative">
								<label class="floating-label" for="txtGrossSalary">Gross Salary</label>
								<div class="input-group">
									<input type="text"
										   class="form-control floating-input"
										   id="txtGrossSalary"
										   placeholder="Gross Salary"
										   data-decimal />
									<span class="input-group-text p-0 px-1">
										<i class="bx bx-building allowanceIcon" style="font-size: 18px;cursor:pointer"></i>
									</span>
								</div>
								<span id="spnGrossSalary" style="color:red; display:none;">Please Enter GrossSalary</span>
							</div>
						</div>

						<div class="col-md-4">
							<div class="form-group mt-3 position-relative">
								<input type="text" data-decimal class="form-control floating-input" id="txtBasicSalary" placeholder="Basic Salary">
								<label class="floating-label" for="txtBasicSalary">Basic Salary</label>
							</div>
							<span id="spnBasicSalary" style="color:red; display:none;">Please Enter Basic Salary</span>
						</div>

						<!-- Updated Category Select -->
						<div class="col-md-4">
							<div class="mt-3 form-floating-custom">
								<div class="searchable-select-wrapper" id="categoryWrapper">
									<label for="ddlCategory">Category <span class="text-danger">*</span></label>
									<input type="text" class="searchable-select-input" id="ddlCategory" readonly>
									<span class="searchable-select-arrow">
										<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
											<path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z" />
										</svg>
									</span>
									<div class="searchable-select-dropdown">
										<div class="searchable-select-search">
											<input type="text" placeholder="Search category..." class="search-input">
										</div>
										<div class="searchable-select-options"></div>
									</div>
								</div>
								<span id="spnCategory" style="color:red; display:none;">Please Select Category</span>
							</div>
						</div>

						<!-- Updated Department Select (already in your code) -->
						<div class="col-md-4">
							<div class="mt-3 form-floating-custom">
								<div class="searchable-select-wrapper" id="departmentWrapper">
									<label for="ddlDepartment">Department <span class="text-danger">*</span></label>
									<input type="text" class="searchable-select-input" id="ddlDepartment" readonly>
									<span class="searchable-select-arrow">
										<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
											<path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z" />
										</svg>
									</span>
									<div class="searchable-select-dropdown">
										<div class="searchable-select-search">
											<input type="text" placeholder="Search department..." class="search-input">
										</div>
										<div class="searchable-select-options"></div>
									</div>
								</div>
								<span id="spnDepartment" style="color:red; display:none;">Please Select Department</span>
							</div>
						</div>

						<!-- Updated Employee Type Select -->
						<div class="col-md-4">
							<div class="mt-3 form-floating-custom">
								<div class="searchable-select-wrapper" id="empTypeWrapper">
									<label for="ddlEmpType">Employee Type <span class="text-danger">*</span></label>
									<input type="text" class="searchable-select-input" id="ddlEmpType" readonly>
									<span class="searchable-select-arrow">
										<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
											<path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z" />
										</svg>
									</span>
									<div class="searchable-select-dropdown">
										<div class="searchable-select-search">
											<input type="text" placeholder="Search employee type..." class="search-input">
										</div>
										<div class="searchable-select-options"></div>
									</div>
								</div>
								<span id="spnEmployeeType" style="color:red; display:none;">Please Select Employee Type</span>
							</div>
						</div>

						<div class="col-md-4">
							<div class="form-group mt-3 position-relative">
								<input type="date" class="form-control floating-input" id="dob" placeholder=" ">
								<label class="floating-label" for="dob">Date of Birth<span class="required-star">*</span></label>
							</div>
							<span id="spnBirth" style="color:red; display:none;">Please Select Date Of Birth</span>
						</div>

						<!-- Updated Role Select -->
						<div class="col-md-4">
							<div class="mt-3 form-floating-custom">
								<div class="searchable-select-wrapper" id="roleWrapper">
									<label for="ddlRole">Role <span class="text-danger">*</span></label>
									<input type="text" class="searchable-select-input" id="ddlRole" readonly>
									<span class="searchable-select-arrow">
										<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
											<path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z" />
										</svg>
									</span>
									<div class="searchable-select-dropdown">
										<div class="searchable-select-search">
											<input type="text" placeholder="Search role..." class="search-input">
										</div>
										<div class="searchable-select-options"></div>
									</div>
								</div>
								<span id="spnRole" style="color:red; display:none;">Please select Role</span>
							</div>
						</div>

						<div class="col-md-4">
							<div class="form-group mt-3">
								<div class="input-group">
									<input type="text" class="form-control floating-input w-50" id="txtLoginAlias" placeholder="Login Alias">
									<span class="input-group-text p-0 w-50" id="txtDomainName"
										  style="white-space: nowrap;
                                             overflow: hidden;
                                             text-overflow: ellipsis;
                                             display: inline-block;
                                             padding: 6px 10px;">
									</span>
								</div>
								<span id="spnLoginAlias" style="color:red; display:none;">Please Enter Login Alias</span>
							</div>
						</div>

						<div class="col-md-4">
							<div class="form-group mt-3 position-relative">
								<input type="password" class="form-control floating-input" id="txtPassword" disabled value="Relay@@123" placeholder="Password" style="padding-right: 40px;">
								<label class="floating-label" for="txtPassword">Password <span class="required-star">*</span></label>
								<i id="togglePassword" class='bx bx-show'
								   style="position: absolute; top: 50%; right: 10px; transform: translateY(-50%); cursor: pointer; font-size: 1.2rem; color: #666;">
								</i>
							</div>
							<span id="spnPassword" style="color:red; display:none;">Please Enter Password</span>
							<span id="spnPasswordError" style="color:red; display:none;">Please Enter Valid Password</span>
						</div>

					
						<div class="col-md-4">
							<div class="mt-3 form-floating-custom">
								<div class="searchable-select-wrapper" id="weekOffWrapper">
									<label for="ddlWeekOfAssign">WeekOff Assign <span class="text-danger">*</span></label>
									<input type="text" class="searchable-select-input" id="ddlWeekOfAssign" readonly>
									<span class="searchable-select-arrow">
										<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
											<path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z" />
										</svg>
									</span>
									<div class="searchable-select-dropdown">
										<div class="searchable-select-search">
											<input type="text" placeholder="Search WeekOff..." class="search-input">
										</div>
										<div class="searchable-select-options"></div>
									</div>
								</div>
								<span id="spnWeekOff" style="color:red; display:none;">Please Enter Week Off</span>
							</div>
						</div>

						<!-- Updated Reporting Manager Select -->
						<div class="col-md-4">
							<div class="mt-3 form-floating-custom">
								<div class="searchable-select-wrapper" id="reportingWrapper">
									<label for="drpReporting">Reporting Manager <span class="text-danger">*</span></label>
									<input type="text" class="searchable-select-input" id="drpReporting" readonly>
									<span class="searchable-select-arrow">
										<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
											<path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z" />
										</svg>
									</span>
									<div class="searchable-select-dropdown">
										<div class="searchable-select-search">
											<input type="text" placeholder="Search reporting manager..." class="search-input">
										</div>
										<div class="searchable-select-options"></div>
									</div>
								</div>
								<span id="spnReporting" style="color:red; display:none;">Please Select Reporting Manager</span>
							</div>
						</div>

						<div class="col-md-2">
							<div class="form-check mt-4">
								<input class="form-check-input" type="checkbox" id="pt" checked>
								<label class="form-check-label" for="pt">PT</label>
							</div>
						</div>
						<div class="col-md-2">
							<div class="form-check mt-4">
								<input class="form-check-input" type="checkbox" id="checkInOut">
								<label class="form-check-label" for="checkInOut">Punch In Out</label>
							</div>
						</div>
						<div class="col-md-2">
							<div class="form-check mt-4">
								<input class="form-check-input" checked type="checkbox" id="isPFApplicable">
								<label class="form-check-label" for="isPFApplicable">Is PF Applicable</label>
							</div>
						</div>
						<div class="col-md-2">
							<div class="form-check mt-4">
								<input class="form-check-input" type="checkbox" id="probation">
								<label class="form-check-label" for="probation">Probation</label>
							</div>
						</div>
					</div>
				</form>
			</div>
			<div class="modal-footer btn-heading-title">
				<button type="button" class="btn btn-primary" id="btnCreateEmployee" style="background-color:#2395c6; color:white;">Save</button>
				<button type="button" class="btn btn-primary" id="btnCreatingEmployee" style="background-color:#2395c6; color:white;display:none" disabled><span class="spinner-border spinner-border-sm me-2" role="status"></span> Saving...</button>
				<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
			</div>
		</div>
	</div>
</div>

<!-- The Modal -->
<div class="modal " id="schemeAssignModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title btn-heading-title" id="exampleModalLabel">
					<span class="formType">Scheme Assigned Details</span>
				</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" data-bs-toggle="modal" data-bs-target="#addEmployeeModal" aria-label="Close"></button>
			</div>
			<div class="modal-body modal-body-font">
				<table class="table table-bordered">
					<thead>
						<tr>
							<th style="width:25%">Scheme Type</th>
							<th style="width:25%">Scheme</th>
							<th style="width:25%">Scheme Type</th>
							<th style="width:25%">Scheme</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td>Attendance Regularization</td>
							<td>
								<div class="form-group mt-2 position-relative ">
									<select class="form-control floating-input" id="ddlRegularization">
										<option value="">Select Scheme</option>
										<option>Regularization1</option>
										<!-- Add more options as needed -->
									</select>
									<label class="floating-label" for="ddlRegularization">Attendance Regularization</label>
								</div>
							</td>
							<td>Leave Application</td>
							<td>
								<div class="form-group mt-2 position-relative ">
									<select class="form-control floating-input" id="ddlLeave">
										<option value="">Select Scheme</option>
										<option>Leave_1</option>
										<!-- Add more options as needed -->
									</select>
									<label class="floating-label" for="ddlLeave">Leave Application</label>
								</div>
							</td>
						</tr>
						<tr>
							<td>Claim Application</td>
							<td>
								<div class="form-group mt-2 position-relative ">
									<select class="form-control floating-input" id="ddlClaim">
										<option value="">Select Scheme</option>
										<option>Claim1</option>
										<!-- Add more options as needed -->
									</select>
									<label class="floating-label" for="ddlClaim">Claim Application</label>
								</div>
							</td>
							<td>Loan Application</td>
							<td>
								<div class="form-group mt-2 position-relative ">
									<select class="form-control floating-input" id="ddlLoan">
										<option value="">Select Scheme</option>
										<option>Loan1</option>
										<!-- Add more options as needed -->
									</select>
									<label class="floating-label" for="ddlLoan">Loan Application</label>
								</div>
							</td>
						</tr>
					</tbody>
				</table>
			</div>
			
		</div>
	</div>
</div>


<div class="modal" id="SalaryAllowanceModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
	<div class="modal-dialog modal-xl">
		<div class="modal-content">
			<div class="modal-header">
				
				<button type="button" class="btn-close " id="closeBtnSalary" ></button>
			</div>

			<div class="modal-body modal-body-font">
				<div style="max-height: 70vh; overflow-y: auto;">
 						<div id="SalaryPartialView">
							<!-- Your dynamic content goes here -->
						</div>
				  </div>
				</div>
		</div>
	</div>
</div>

<div id="grid-loader"
	 class="grid-loader justify-content-center align-items-center flex-column"
	 style="display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: rgba(255, 255, 255, 0.6); backdrop-filter: blur(3px); z-index: 9999;">

	<img src="@baseAPIDomainUrl/loders/loder.png"
		 class="grid-logo-spinner"
		 style="width: 40px; height: 40px; animation: spin 1s linear infinite;" />

	<div class="grid-loading-text text-dark " style="font-size: 16px;">Loading...</div>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
	<script>
		$(document).ready(function() {
			// Handle radio button change
			$('input[name="employeeOptions"]').on('change', function() {
				if ($(this).is(':checked')) {
					const labelText = $('label[for="' + $(this).attr('id') + '"]').text();
					$('#selectedValue').text('Selected: ' + labelText);
				}
			});

			// Add interactive feedback with jQuery
			$('.radio-button label').on('mousedown', function() {
				$(this).css('transform', 'translateY(-1px) scale(0.98)');
			}).on('mouseup mouseleave', function() {
				$(this).css('transform', '');
			});

			// Optional: Add click animation
			$('.radio-button label').on('click', function() {
				$(this).addClass('clicked');
				setTimeout(() => {
					$(this).removeClass('clicked');
				}, 200);
			});
		});
	</script>
<script>
	const savedCompany = localStorage.getItem('selectedCompany');
	var companyDetails = JSON.parse(savedCompany);
	const CompanyId=companyDetails.CompanyId;
	const EmployeeId=localStorage.getItem('EmployeeId');
	const Token=localStorage.getItem("authToken");
	let ReasonId=0;

	async function showbtnLoder(){
		$('#btnCreatingEmployee').show();
		$('#btnCreateEmployee').hide();
	}
	async function hidebtnLoder(){
				  $('#btnCreatingEmployee').hide();
		  $('#btnCreateEmployee').show();
	}


	$('input[name="options"]').change( async function() {
		$('label.btn').removeClass('active');
		$(this).parent().addClass('active');
		const name = $(this).attr('name');
		
		// Use name and value as needed
	   const selectedValue = $(this).val();
		// Define employeeUrl based on selected value
		let IsLeft=true;
		let employeeUrl="";
		let gridId="";

		if (selectedValue === 'AllEmployee') {
			$("#gridLeftContainerEmployee").hide();
			$("#gridAllContainerEmployee").show();
			$("#gridCurrentContainerEmployee").hide();
			gridId = "#gridAllContainerEmployee";
			employeeUrl = '@baseUrl/EmployeeMasterAPI/GetAllEmployee';
		} else if (selectedValue === 'LeftEmployee') {
			IsLeft = true;
			$("#gridLeftContainerEmployee").show();
			$("#gridAllContainerEmployee").hide();
			$("#gridCurrentContainerEmployee").hide();
			gridId = "#gridLeftContainerEmployee";
			employeeUrl = '@baseUrl/EmployeeMasterAPI/GetAllEmployeeActiveOrLeft/' + IsLeft;
		} else if (selectedValue === 'CurrentEmployee') {
			$("#gridLeftContainerEmployee").hide();
			$("#gridAllContainerEmployee").hide();
			$("#gridCurrentContainerEmployee").show();
			gridId = "#gridCurrentContainerEmployee";
			IsLeft = false;
			employeeUrl = '@baseUrl/EmployeeMasterAPI/GetAllEmployeeActiveOrLeft/' + IsLeft;
		}


		// Clear previous grid data and show loading spinner
		$("#rowCountEmployee").text("");

		// Ensure EmployeeDetailsDataTable is defined and call it
		if (typeof EmployeeDetailsDataTable === 'function') {
			await EmployeeDetailsDataTable(gridId, employeeUrl);
		} else {
			console.error('EmployeeDetailsDataTable is not defined');
		}
	});

	
	  $('#ddlEmpType').change(function() {
			var selectedText = $(this).find('option:selected').text().toLowerCase();
			console.log("Selected Text: " + selectedText);

			if(selectedText === "probation") {
				$("#probation").prop('checked', true);
			} else {
				$("#probation").prop('checked', false);
			}
	  });


	$("#addEmployee").click( async () => {
	    $("#btnCreateEmployee").prop("disabled", false);
	     resetEmployeeMasterField();
		 $('#pt').prop('checked', true);
		 $('#isPFApplicable').prop('checked', true);
		$("#addEmployeeModal").modal('show');

	})
	$("#WeekAssign").click(()=>{
	   $("#weekOffAssignModal").modal('show');

	})
	$("#closeBtnSalary,#closeBtnWeekOff").click(()=>{
	   $("#weekOffAssignModal").modal('hide');
	   $("#SalaryAllowanceModal").modal('hide');
	   
	})
			
	$(document).ready(async function() {
		try {
			
		    GetNextEmployeeCode();

			// Ensure localStorage item is removed
			localStorage.removeItem('employeeDetailsLocalStorage');
			
			$("#rowCountEmployee").text("");
			// Load initial employee data
			await EmployeeDetailsDataTable('#gridAllContainerEmployee', '@baseUrl/EmployeeMasterAPI/GetAllEmployee');

			
		} catch (error) {
			console.error('Error loading company details:', error);
		}
	});

	
	
	async function EmployeeDetailsDataTable(gridId, employeeUrl) {
		if (!CompanyId) {
			round_error_noti("Please select company");
			return;
		}
		if(gridId=='#gridAllContainerEmployee')
		{
			$("#allEmployee").prop("checked", true);
		}
			 $('#grid-loader').addClass('d-flex').show();
			$.ajax({
				type: "GET",
				url: employeeUrl + "?companyId=" + CompanyId,
				success: function(data) {
					if (data.isSuccess) {
						$("#spnNoRecord").hide();
						$(".gridTag").show();
						$(gridId).dxDataGrid({
							dataSource: data.data,
							rowHeight: 40,
							width: '100%',
							columns: [

								{
									dataField: 'alfaEmployeeCode',
									caption: 'Employee Code',
								
								},
								{ dataField: 'fullName', caption: 'Full Name',  width: 250 },
									{ dataField: 'branchName', caption: 'Branch',   },
							    { dataField: 'gradeName', caption: 'Grade',   },
								{ dataField: 'departmentName', caption: 'Department',  },
								{ dataField: 'designationName', caption: 'Designation',  },
								 {dataField: 'dateOfJoining', caption: 'Date of Joining',  dataType: 'date',format: 'dd-MM-yyyy'  },
								  { dataField: 'loginAlias', caption: 'Login Alias'},

									{
										dataField: 'isLeft',
										caption: 'IsLeft',
										cellTemplate: function(container, options) {
											const value = options.value;
											$('<div>')
												.text(value === 'Yes' ? 'Yes' : 'No')
												.css('color', value === 'Yes' ? 'red' : 'green')
												.appendTo(container);
										}
									},

									{
									dataField: 'leftDate',
									caption: 'Left Date',
									dataType: 'date',
									format: 'dd-MM-yyyy',
									visible: false
								},
								
								{
									dataField: '',
									caption: '',
									width: '50px',									
									cellTemplate: function(container, options) {
										var buttonElement = $('<div class="d-flex order-actions">' +
											'<a href="javascript:;" class="edit-action" title="Edit Employee">' +
											'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eyedropper" viewBox="0 0 16 16">' +
											'<path d="M13.354.646a1.207 1.207 0 0 0-1.708 0L8.5 3.793l-.646-.647a.5.5 0 1 0-.708.708L8.293 5l-7.147 7.146A.5.5 0 0 0 1 12.5v1.793l-.854.853a.5.5 0 1 0 .708.707L1.707 15H3.5a.5.5 0 0 0 .354-.146L11 7.707l1.146 1.147a.5.5 0 0 0 .708-.708l-.647-.646 3.147-3.146a1.207 1.207 0 0 0 0-1.708zM2 12.707l7-7L10.293 7l-7 7H2z"/>' +
											'</svg>' +
											'</a>' +
											'</div>')
											.on('dxclick', function() {
												updateEmployeeDetails(options.data);
											}).appendTo(container);
									}
								},
								{
									dataField: '',
									caption: '',
									width: '50px',									
									cellTemplate: function(container, options) {
										var buttonElement = $('<div class="d-flex order-actions">' +
											'<a href="javascript:;" class="delete-action" title="Delete Employee">' +
											'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash-fill" viewBox="0 0 16 16">' +
											'<path d="M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5M8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7A.5.5 0 0 1 8 5m3 .5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 1 0"/>' +
											'</svg>' +
											'</a>' +
											'</div>')
											.on('dxclick', function() {
												deleteEmployeeDetails(options.data);
											}).appendTo(container);
									}
								}
							],
							columnsAutoWidth: false,
							wordWrapEnabled: false,
							showBorders: true,
							rowAlternationEnabled: false,
							showBorders: true,
							grouping: { autoExpandAll: true },
							paging: { pageSize: 10 },
							pager: { showPageSizeSelector: true, allowedPageSizes: [10, 25, 50, 100] },
							headerFilter: { visible: false },
							filterRow: { visible: false, applyFilter: "auto" },
							allowColumnResizing: true,
							groupPanel: { visible: false },
							searchPanel: { visible: false, width: 240, placeholder: "Search..." },
							columnFixing: {
								enabled: true
							},
							scrolling: {
								mode: "standard",
								useNative: false,
								scrollByContent: true,
								scrollByThumb: true,
							},

								onContentReady(e) {

									 const hasLeftEmployees = e.component.getDataSource().items().some(item => item.isLeft);

									// Show/hide the LeftDate column based on the check
									e.component.columnOption('leftDate', 'visible', hasLeftEmployees);

							$('#rowCountEmployee').html('Total Records: ' + e.component.totalCount());

							// Show toolbar only if data exists
								if (e.component.totalCount() > 0) {
							  $('#gridToolbar').attr('style', 'display: flex !important;');
									$("#gridSearchBox").dxTextBox({
										placeholder: "Search...",
										showClearButton: true,
										mode: "search", // This adds the search icon
										onValueChanged: function(args) {
											e.component.searchByText(args.value);
										}
									});
								}
						}

						});
							  

					} else {
							$(".gridTag").hide();
						$("#spnNoRecord").show();
					}

					 $('#grid-loader').removeClass('d-flex').hide();
				},
				error: function(xhr, status, error) {
					console.error("AJAX Error: " + status + " - " + error);
					$('#grid-loader').removeClass('d-flex').hide();
				}
			})
	}



		   function deleteEmployeeDetails(data) {
			   if (!confirm("Are you sure you want to delete this employee?")) {
				   return; // Cancel the delete operation
			   }

			   var deleteObj = {
				   Id: data.id,
				   deletedBy: EmployeeId
			   };
			   $.ajax({
				   url: '@baseUrl/EmployeeMasterAPI/DeleteEmployee',
				   type: 'DELETE',
				   contentType: 'application/json',
				   data: JSON.stringify(deleteObj),
				   success: function (response) {
					   if (response.isSuccess) {
						   round_success_noti(response.responseMessage);
		                EmployeeDetailsDataTable('#gridAllContainerEmployee', '@baseUrl/EmployeeMasterAPI/GetAllEmployee');

					   } else {
						   round_error_noti(response.responseMessage);
					   }
							 
				   },
				   error: function (error) {
					   console.log('Error deleting reason!');
				   }
			   });
		   }



	async function loadEmployeeRecords(){
	   $.ajax({
				url: '@baseUrl/EmployeeMasterAPI/GetRecordsForAdd/'+CompanyId,
				method: 'GET',
				success: function(response) {
						if (response.isSuccess)
						{
							bindBranch(response.data.branches);
							bindCategory(response.data.categories);
							bindDesignation(response.data.designations);
							bindReporting(response.data.reportingEmployees);
							bindDepartment(response.data.departments);
							bindGrade(response.data.grades);
							bindRole(response.data.roles);
							bindEmployeeType(response.data.employeeTypes);
							bindShift(response.data.shifts);
						}
						
				},
				error: function(error) {
					console.error('Error fetching  data:', error);
						 
				}
			});

	}

	            
	
	         function bindInitial()
			 {
				 var data=
				 [
				  {"initial":"Mr."},
				  {"initial":"Mrs."},
				  {"initial":"Ms."}
				 ]
					$('#ddlInitial').searchableSelect({
					  data: data||[],
						valueKey: 'initial',
						textKey: 'initial',
						placeholder:'Initial',
						searchPlaceholder: 'Search initial...',
					  onChange: function(item) {

					  }
				  });
			 }

		   function bindBranch(data)
		   {
				 $('#ddlBranch').searchableSelect({
					data: data||[],
					valueKey: 'branchId',
					textKey: 'branchName',
					placeholder:'Branch',
					searchPlaceholder: 'Search branch...',
					onChange: function(item) {
						  LoadWeekOffMaster();
					}
				});

		   }

		   function bindDesignation(data)
		   {
				$('#ddlDesignation').searchableSelect({
					data: data||[],
					valueKey: 'designationId',
					textKey: 'designationName',
					placeholder:'Designation',
					searchPlaceholder: 'Search designation...',
					onChange: function(item) {

					}
				});
		   }

		   function bindCategory(data){
				
				 $('#ddlCategory').searchableSelect({
					data: data||[],
					valueKey: 'categoryId',
					textKey: 'categoryName',
					placeholder:'Category',
					searchPlaceholder: 'Search category...',
					onChange: function(item) {

				    }
	             });
		   }

			async function bindReporting(data)
			{
				$('#drpReporting').searchableSelect({
					data: data||[],
					valueKey: 'employeeId',
					textKey: 'employeeName',
					placeholder:'Reporting Manager',
					searchPlaceholder: 'Search reporting...',
					onChange: function(item) {

					}
				 });
			}

			async  function bindDepartment(data)
			{
				
				$('#ddlDepartment').searchableSelect({
					data: data||[],
					valueKey: 'departmentId',
					textKey: 'departmentName',
					placeholder:'Department',
					searchPlaceholder: 'Search department...',
					onChange: function(item) {

					}
				});
			}

		async function bindGrade(data)
		{
			 $('#ddlGrade').searchableSelect({
					data: data||[],
					valueKey: 'gradeId',
					textKey: 'gradeName',
					placeholder:'Grade',
					searchPlaceholder: 'Search grade...',
					onChange: function(item) {

					}
			  });
		}

		async function bindRole(data)
		{
				$('#ddlRole').searchableSelect({
					data: data||[],
					valueKey: 'roleId',
					textKey: 'roleName',
					placeholder:'Role',
					searchPlaceholder: 'Search role...',
					onChange: function(item) {

					}
			   });
		}

		async function bindEmployeeType(data)
		{
			$('#ddlEmpType').searchableSelect({
				data: data||[],
				valueKey: 'employeeTypeId',
				textKey: 'employeeTypeName',
				placeholder:'EmployeeType',
				searchPlaceholder: 'Search employee type...',
				onChange: function(item) {

				}
			   });
		}

		async function bindShift(data)
		{
			
			 $('#ddlShift').searchableSelect({
				data: data||[],
				valueKey: 'shiftId',
				textKey: 'shiftName',
				placeholder:'Shift',
				searchPlaceholder: 'Search shift...',
				onChange: function(item) {

				}
			  });

		}
		  async function bindWeekOff()
		{

			   $('#ddlWeekOfAssign').searchableSelect({
					data: [],
					valueKey: 'weekOffDetailsId',
					textKey: 'weekOffName',
					placeholder:'WeekOff Name',
					searchPlaceholder: 'Search weekOff...',
					onChange: function(item) {

					}
				});

		}


	function LoadWeekOffMaster()
	{
		   let branchId = $('#ddlBranch').data('searchableSelect').getValue();
			// Validation
			if (!branchId) {
				round_error_noti("Please select branch first!");
				return;
			} 
			var data={
				branchId:branchId,
				CompanyId:CompanyId
			}
			// API call
			$.ajax({
				url: '@baseUrl/WeekOffMasterAPI/GetAllWeekOffDetails',
				type: "Post",
				contentType: 'application/json',
				data: JSON.stringify(data),
				success: function (res) {
				
					const dropdownddlWeekOfAssign = $('#ddlWeekOfAssign').data('searchableSelect');
					  if(dropdownddlWeekOfAssign){
								dropdownddlWeekOfAssign.setData(res.data);
					  }
					
				},
				error: function () {
					round_error_noti("Failed to fetch week off data.");
				}
			});

	}

	async function GetExistEmployeeCode()
	{
		 var NumberCode = $('#txtNumberEmpCode').val();

			// Validation
			if (!NumberCode) {
				round_error_noti("Please enter employee code");
				return;
			} 
			var data={
				EmployeeCode:NumberCode,
				CompanyId:CompanyId
			}
			// API call
			$.ajax({
				url: '@baseUrl/EmployeeMasterAPI/GetExistEmployeeCode',
				type: "Post",
				contentType: 'application/json',
				data: JSON.stringify(data),
				success: function (res) {
					if(res.isSuccess){
						if(res.data){
							if(res.data.employeeCode!=null){
								round_error_noti(`The '${res.data.employeeCode}' is already exist!`)
							}
						}
					}
				},
				error: function () {
					round_error_noti("Failed to fetch exist employeeCode.");
				}
			});

	}
	$(document).ready(function() {
		  bindWeekOff();
		  bindInitial();
			loadEmployeeRecords();
			$('#gridToolbar').hide();

		
		$('#txtLoginAlias').on('input', function () {
            var inputVal = $(this).val();
            var domain = $('#txtDomainName').text().trim();

            if (inputVal.includes('@@')) {
				round_error_noti(`The domain "${domain}" is already added.`);
                
                // Optionally remove the '@@' from the input
                $(this).val(inputVal.replace('@@', ''));
            }
        });

		$('#togglePassword').click(function() {
			let passwordInput = $('#txtPassword');
			let type = passwordInput.attr('type') === 'password' ? 'text' : 'password';
			passwordInput.attr('type', type);

			// Toggle icon class
			$(this).toggleClass('bx-show bx-hide');
		});
		$('#txtNumberEmpCode').blur(async function() {
			await GetExistEmployeeCode();
		}); 

		
	$('#btnCreateEmployee').click(function() {
	           showbtnLoder();			
			var initial = $('#ddlInitial').data('searchableSelect').getValue();
			var firstName = $('#txtFirstName').val().trim();
			var middleName = $('#txtMiddleName').val().trim();
			var lastName = $('#txtLastName').val().trim();
			var employeeStringCode = $('#txtEmpCode').val(); // Assuming the first input is for EmployeeStringCode
			var employeeNumberCode = $('#txtNumberEmpCode').val(); // Assuming the second input is for EmployeeNumberCode
			var dateOfJoining = $('#doj').val();
			var branch = $('#ddlBranch').data('searchableSelect').getValue();
			var grade = $('#ddlGrade').data('searchableSelect').getValue();
			var shift = $('#ddlShift').data('searchableSelect').getValue();
			var ctc = null;
			var designation = $('#ddlDesignation').data('searchableSelect').getValue();
			var grossSalary = $('#txtGrossSalary').val().trim();
				var category = $('#ddlCategory').data('searchableSelect').getValue();
			var basicSalary = $('#txtBasicSalary').val();
			var department = $('#ddlDepartment').data('searchableSelect').getValue();
			var employeeType =$('#ddlEmpType').data('searchableSelect').getValue();
			var dateOfBirth = $('#dob').val();
			var RoleId = $('#ddlRole').data('searchableSelect').getValue();
			var loginAlias = $('#txtLoginAlias').val().trim();
			var password = $('#txtPassword').val().trim();
			var domainName = $('#txtDomainName').text().trim();
			var DrpweekOfAssignId = $('#ddlWeekOfAssign').data('searchableSelect');
			weekOfAssignId=null;
			  if(DrpweekOfAssignId)
			  {
					weekOfAssignId=DrpweekOfAssignId.getValue();
			  }
			var pt = $('#pt').is(':checked');
			var checkInOut = $('#checkInOut').is(':checked');
			 var patternPassword = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@@$!%*?&])[A-Za-z\d@@$!%*?&]{8,}$/;

			var reportingManager=$('#drpReporting').data('searchableSelect').getValue();
				var isPFApplicable = $('#isPFApplicable').is(':checked');
	             var probation = $('#probation').is(':checked');
			var Company = CompanyId;
				// Validate required fields
	           var isValid = true;
				if (!initial) {
					$('#spnInitial').show();
					isValid = false;
				}
				else{
					$('#spnInitial').hide();
				}

				if (!firstName) {
					$('#spnFirstName').show();
					isValid = false;
				}
				else{
					$('#spnFirstName').hide();
				}
				// if (!employeeStringCode) {
				// 	$('#spnNumberCode').hide();
				// 	$('#spnStringCode').show();
				// 	isValid = false;
				// }
				// else{
				// 	$('#spnStringCode').hide();
	                
				// }

				if (!employeeNumberCode) {
						$('#spnNumberCode').show();
						isValid = false;
				}
				else{
					$('#spnNumberCode').hide();
				}
				if (!dateOfJoining) {
					$('#spnDoj').show();
					isValid = false;
				}
				else{
					$('#spnDoj').hide();
				}
				if (!branch) {
					$('#spnBranch').show();
					isValid = false;
				}
				else{
					$('#spnBranch').hide();
				}
				if (!grade) {
					$('#spnGrade').show();
					isValid = false;
				}
				else{
					$('#spnGrade').hide();
				}
				if (!shift) {
					$('#spnShift').show();
					isValid = false;
				}
				else{
					$('#spnShift').hide();
				}
				if (!designation) {
					$('#spnDesignation').show();
					isValid = false;
				}
				else{
					$('#spnDesignation').hide();
				}
				if (!grossSalary) {
					$('#spnGrossSalary').show();
					isValid = false;
				}
				else{
					$('#spnGrossSalary').hide();
				}
				if (!basicSalary) {
					$('#spnBasicSalary').show();
					isValid = false;
				}
				else{
					$('#spnBasicSalary').hide();
				}


				if (!category) {
					$('#spnCategory').show();
					isValid = false;
				}
				else{
					$('#spnCategory').hide();
				}
				if (!department) {
					$('#spnDepartment').show();
					isValid = false;
				}
				else{
					$('#spnDepartment').hide();
				}
				if (!employeeType) {
					$('#spnEmployeeType').show();
					isValid = false;
				}
				else{
					$('#spnEmployeeType').hide();
				}
				if (!dateOfBirth) {
					$('#spnBirth').show();
					isValid = false;
				}
				else{
					$('#spnBirth').hide();
				}
				if (!RoleId) {
					$('#spnRole').show();
					isValid = false;
				}
				else{
					$('#spnRole').hide();
				}


				if (!loginAlias) {
					$('#spnLoginAlias').show();
					isValid = false;
				}else{
					$('#spnLoginAlias').hide();
				}

				if (!password) {
					$('#spnPasswordError').hide();
					$('#spnPassword').show();
					isValid = false;
				}
				else{
					$('#spnPassword').hide();
					if (patternPassword.test(password)) {
						$('#spnPasswordError').hide();
						
					} else {
						$('#spnPasswordError').show();
					}
				}
				if (!weekOfAssignId) {
					$('#spnWeekOff').show();
					isValid = false;
				}else{
					$('#spnWeekOff').hide();
				}
				if (!reportingManager) {
					$('#spnReporting').show();
					isValid = false;
				}else{
					$('#spnReporting').hide();
				}
				if (!isValid) {
					  hidebtnLoder();
					return; 
				}
			// Create employeeData object
						var employeeData = {
						Id:null,
						CompanyId:Company===""?null:Company,
						Initial: initial === "" ? null : initial,
						FirstName: firstName === "" ? null : firstName,
						MiddleName: middleName === "" ? null : middleName,
						LastName: lastName === "" ? null : lastName,
						FullName: `${initial} ${firstName} ${middleName} ${lastName}`.trim(),
						EmployeeCode: `${employeeNumberCode}`.trim(),
						AlfaCode: `${employeeStringCode}`===""?null:`${employeeStringCode}`,
						AlfaEmployeeCode: `${employeeStringCode}${employeeNumberCode}`.trim(),
						DateOfJoining: dateOfJoining === "" ? null : dateOfJoining,
						BranchId: branch === "" ? null : branch,
						GradeId: grade === "" ? null : grade,
						ShiftMasterId: shift === "" ? null : shift,
						DesignationId: designation === "" ? null : designation,
						GrossSalary: grossSalary === "" ? null : grossSalary,
						CategoryId: category === "" ? null : category,
						BasicSalary: basicSalary===""?null:basicSalary,
						DepartmentId: department === "" ? null : department,
						EmployeeTypeId: employeeType === "" ? null : employeeType,
						DateOfBirth: dateOfBirth === "" ? null : dateOfBirth,
						RoleId: RoleId === "" ? 0 : RoleId,
						LoginAlias: loginAlias === "" ? null : `${loginAlias}${domainName}`,
						Password: password,
					    ReportingManagerId:reportingManager==""? null:reportingManager,

						
						Pt: pt === "" ? false : pt,
						Pt: isPFApplicable === "" ? false : isPFApplicable,
						Probation:probation,
						// Default values for properties not present in the JavaScript object
						
					
						CreatedBy: EmployeeId,
						UpdatedBy: null,
						
						EmployeeProfileUrl: null,
						EmployeeSignatureUrl: null,
						WeekOffDetailsId:weekOfAssignId==""?null:weekOfAssignId,
						IsPermissionPunchInOut:checkInOut
					};
					//console.log("employeeData: ", employeeData);

					

			// Send data to server using AJAX
				$.ajax({
					url: '@baseUrl/EmployeeMasterAPI/CreateEmployee',
					type: 'POST',
					contentType: 'application/json',
					data: JSON.stringify(employeeData),
					success: function(response) {
						if (response.isSuccess) {
							round_success_noti(response.responseMessage);
					      EmployeeDetailsDataTable('#gridAllContainerEmployee', '@baseUrl/EmployeeMasterAPI/GetAllEmployee');
							GetNextEmployeeCode();
						  $("#addEmployeeModal").modal('hide');
						} else {
							round_error_noti(response.responseMessage);
						}
						  hidebtnLoder();
					},
					error: function(xhr, status, error) {
						  hidebtnLoder();

						console.error('Error:', error);
						
					}
				});

		});
	});


    function resetEmployeeMasterField() {
		$('#txtFirstName').val('');
		$('#txtMiddleName').val('');
		$('#txtLastName').val('');
		$('#txtGrossSalary').val('');
		$('#txtBasicSalary').val('');
		$('#txtLoginAlias').val('');


		const dropdowns = [
			{ selector: '#ddlDepartment', wrapper: '#departmentWrapper' },
			{ selector: '#ddlBranch', wrapper: '#branchWrapper' },
			{ selector: '#ddlGrade', wrapper: '#gradeWrapper' },
			{ selector: '#ddlShift', wrapper: '#shiftWrapper' },
			{ selector: '#ddlDesignation', wrapper: '#designationWrapper' },
			{ selector: '#ddlCategory', wrapper: '#categoryWrapper' },
			{ selector: '#ddlEmpType', wrapper: '#empTypeWrapper' },
			{ selector: '#ddlRole', wrapper: '#roleWrapper' },
			{ selector: '#drpReporting', wrapper: '#reportingWrapper' }
		];

		dropdowns.forEach(dropdown => {
			const $input = $(dropdown.selector);
			const $wrapper = $(dropdown.wrapper);
			const dropdownInstance = $input.data('floatingSearchableSelect');

			if (dropdownInstance) {
				dropdownInstance.clear();
			} else {
				$input.val('');
			}

			$wrapper.removeClass('has-value');
			$wrapper.find('label').removeClass('active');
		});

		$('#ddlInitial').val('');
		$('#doj').val('');
		$('#dob').val('');

		$('#pt').prop('checked', true);
		$('#checkInOut').prop('checked', false);
		$('#isPFApplicable').prop('checked', true);
		$('#probation').prop('checked', false);

		$('[id^="spn"]').hide();
		$('#btnCreateEmployee').prop('disabled', false);
		$('#txtPassword').val('Relay@@123');
	}

	function updateEmployeeDetails(data)
	{
			// Remove the CurrentCompanyId from localStorage
		localStorage.removeItem('CurrentEmployeeId');
		localStorage.setItem('CurrentEmployeeId', data.id);
		window.location.href = '@UIBaseUrlLayout/AdminPanel/EmployeeMaster/AdditionalInformation';
		
	}

	function GetNextEmployeeCode(){
		if (!CompanyId) {
			round_error_noti("Please select company");
			return;
		}
	   $.ajax({
			url: '@baseUrl/EmployeeMasterAPI/GetNextEmployeeCode/'+CompanyId,
			method: 'GET',
			success: function(data) {
				if(data.isSuccess){
					// Extract values from the data object
					const nextEmployeeCode = data.data.nextEmployeeCode;
					const digitsForEmployeeCode = data.data.digitsForEmployeeCode;
					const companyCode=data.data.companyCode;

					// Ensure nextEmployeeCode is treated as a number
					const numericCode = Number(nextEmployeeCode);

					// Format the nextEmployeeCode with leading zeros
					const formattedEmployeeCode = numericCode.toString().padStart(digitsForEmployeeCode, '0');

					// Set the formatted employee code into the input field
					$('#txtNumberEmpCode').val(formattedEmployeeCode);
				
					if(companyCode)
					{
						$('#tagtxtEmpCode').show();
						$('#txtEmpCode').val(companyCode);
					}
					
					  $('#txtDomainName').text(data.data.domainName).attr('title', data.data.domainName);

				}
			},
			error: function(error) {
				console.error('Error fetching branch data:', error);
			}
		});


	}



</script>

<script>

	$(document).on('click', '.allowanceIcon', async function (e) {
		var grossSalary = $('#txtGrossSalary').val();
		if(!grossSalary)
		{
			round_error_noti("Please enter gross salary");
			return;
		}

		// ⭐ YE 2 LINES ADD KI HAIN - Grade aur Basic Salary update karenge
		await GetGradeBySalaryRange();
		await loadSalaryAllowance();

		$('#SalaryAllowanceModal').modal('show');
	});

	function handleAllowanceIconClick() {
	  // Do something useful
	  alert('Allowance icon clicked!');
	}

	$(document).ready(function () {
		
        $.get('@Url.Action("Allowance", "PartialView")', function (response) {
            $('#SalaryPartialView').html(response);
        });
    });

	$('#txtGrossSalary , #txtBasicSalary').blur(async function () {
		await GetGradeBySalaryRange();
		await loadSalaryAllowance();

	});

	
	
			async function GetGradeBySalaryRange() {
				var grossSalary = $('#txtGrossSalary').val();
				if(!grossSalary){
					return;
				}
				var basicSalary = $('#txtBasicSalary').val();
				var isPFApplicable = $('#isPFApplicable').is(':checked');
				if (basicSalary == null || basicSalary === '') {
					basicSalary = 0;
				}
				var parameter={
					CompanyId:CompanyId,
					IsPFApplicable: isPFApplicable,
					GrossSalary: grossSalary,
					BasicSalary: basicSalary
				}

				try {
					const response = await new Promise((resolve, reject) => {
						$.ajax({
							url: '@baseUrl/EmployeeMasterAPI/GetGradeBySalaryRange' ,
							method: 'POST',
							contentType: 'application/json',
							  data: JSON.stringify(parameter),
							success: function(response) {
								resolve(response);
							},
							error: function(error) {
								reject(error);
							}
						});
					});

					if (response.isSuccess) {
						$('#ddlGrade').data('searchableSelect').setValue(response.data.GradeId );

					}


				} catch (error) {
					console.error('Error fetching data:', error);
				}
			}
	async function loadSalaryAllowance() {
		debugger;
		var grossSalary = $('#txtGrossSalary').val();
		var isPFApplicable = $('#isPFApplicable').is(':checked');
		var basicSalary = 0;

		if(!grossSalary) {
			return;
		}

		try {
			const response = await fetch('@baseUrl/EmployeeSalaryAllowanceAPI/GetLiveEmployeeSalaryAllowance', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json'
				},
				body: JSON.stringify({
					IsPFApplicable: isPFApplicable,
					GrossSalary: grossSalary,
					BasicSalary: basicSalary  // ⭐ Ab ye hamesha 0 jayegi
				})
			});

			const data = await response.json();
			if (data.isSuccess) {
				var arrayDta = data.data;

				// ⭐ PEHLE BASIC SALARY SET KARO
				$('#txtBasicSalary').val(arrayDta.basicSalary);

				// ⭐ PHIR ALLOWANCE MODAL BIND KARO
				bindSalaryAllowance(arrayDta);
			}
		} catch (error) {
			console.error('Fetch error:', error);
		}
	}
	 function formatCurrency(amount) {
		return '₹' + amount.toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
	}

	function bindSalaryAllowance(salaryData) {
		// Earnings
		$('#monthlyGross').text(formatCurrency(salaryData.totalGrossSalary));
		$('#AnualGross').text(formatCurrency(salaryData.totalGrossSalary * 12));

		$('#basicSalaryMonth').text(formatCurrency(salaryData.basicSalary));
		$('#basicSalaryYear').text(formatCurrency(salaryData.basicSalary * 12));
		$('#hraMonth').text(formatCurrency(salaryData.hra));
		$('#hraYear').text(formatCurrency(salaryData.hra * 12));
		$('#deputationAllowanceMonth').text(formatCurrency(salaryData.deputationAllowance));
		$('#deputationAllowanceYear').text(formatCurrency(salaryData.deputationAllowance * 12));
		$('#conveyanceAllowanceMonth').text(formatCurrency(salaryData.conveyanceAllowance));
		$('#conveyanceAllowanceYear').text(formatCurrency(salaryData.conveyanceAllowance * 12));
		$('#medicalAllowanceMonth').text(formatCurrency(salaryData.medicalAllowance));
		$('#medicalAllowanceYear').text(formatCurrency(salaryData.medicalAllowance * 12));
		$('#childEducationAllowanceMonth').text(formatCurrency(salaryData.childEducationAllowance));
		$('#childEducationAllowanceYear').text(formatCurrency(salaryData.childEducationAllowance * 12));
		$('#totalGrossMonth').text(formatCurrency(salaryData.totalGrossSalary));
		$('#totalGrossYear').text(formatCurrency(salaryData.totalGrossSalary * 12));

		// Deductions
		$('#pfMonth').text(formatCurrency(salaryData.employeePF));
		$('#pfYear').text(formatCurrency(salaryData.employeePF * 12));
		$('#esiMonth').text(formatCurrency(salaryData.employeeESI));
		$('#esiYear').text(formatCurrency(salaryData.employeeESI * 12));
		$('#ptMonth').text(formatCurrency(salaryData.professionalTax));
		$('#ptYear').text(formatCurrency(salaryData.professionalTax * 12));
		$('#groupMedicalMonth').text(formatCurrency(salaryData.groupMedical));
		$('#groupMedicalYear').text(formatCurrency(salaryData.groupMedical * 12));
		$('#termInsuranceMonth').text(formatCurrency(salaryData.termInsurance));
		$('#termInsuranceYear').text(formatCurrency(salaryData.termInsurance * 12));
		$('#totalDeductionMonth').text(formatCurrency(salaryData.totalDeductions));
		$('#totalDeductionYear').text(formatCurrency(salaryData.totalDeductions * 12));

		// Net Salary
		$('#netSalaryMonth').text(formatCurrency(salaryData.netSalary));
		$('#netSalaryYear').text(formatCurrency(salaryData.netSalary * 12));

		// CTC calculation
		$('#CalculationGrossMonth').text(formatCurrency(salaryData.ctc));
		$('#CalculationGrossYear').text(formatCurrency(salaryData.ctc * 12));
		$('#CalculationPFMonth').text(formatCurrency(salaryData.employeePF));
		$('#CalculationPFYear').text(formatCurrency(salaryData.employeePF * 12));
		$('#CalculationESIMonth').text(formatCurrency(salaryData.employeeESI));
		$('#CalculationESIMonth').text(formatCurrency(salaryData.employeeESI * 12));
		// CTC
		$('#ctcMonth').text(formatCurrency(salaryData.ctc));
		$('#ctcYear').text(formatCurrency(salaryData.ctc * 12));

		// Summary
		$('#summaryCtc').text(formatCurrency(salaryData.ctc));
		$('#summaryNet').text(formatCurrency(salaryData.netSalary));
		$('#summaryAnnual').text(formatCurrency(salaryData.ctc * 12));
	}


</script>