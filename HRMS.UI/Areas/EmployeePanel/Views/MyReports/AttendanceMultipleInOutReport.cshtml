@inject IConfiguration Configuration
@{
    ViewData["Title"] = "Employee Panel";
    Layout = "~/Areas/EmployeePanel/Views/Shared/_EmployeeLayout.cshtml";
    string baseUrl = Configuration["BaseUrlSettings:baseUrl"];
}
<!-- ✅ Employee In Out Panel -->
<div class="card">
    <div class="card-header bg-transparent ml-0 py-0">
        <div class="row">
            <div class="col-6">
                <h6 class="pt-2 mb-0">Employee In Out</h6>
            </div>
        </div>
    </div>

    <div class="card-body">
        <!-- ✅ Month & Year Dropdown -->
        <div class="row mb-3">
            <div class="col-md-2"></div>
            <div class="col-md-4">
                <select id="dropdownmonth" class="form-control">
                    <option value="">Select Month</option>
                    @for (int i = 1; i <= 12; i++)
                    {
                        var selected = (i == DateTime.Now.Month) ? "selected" : "";
                        <option value="@i" @selected>
                            @System.Globalization.CultureInfo.CurrentCulture.DateTimeFormat.GetMonthName(i)
                        </option>
                    }
                </select>
            </div>
            <div class="col-md-4">
                <select id="dropdownyear" class="form-control">
                    @for (int y = 2024; y <= 2026; y++)
                    {
                        var selected = (y == DateTime.Now.Year) ? "selected" : "";
                        <option value="@y" @selected>@y</option>
                    }
                </select>
            </div>
            <div class="col-md-2">
                <button type="button" class="btn btn-primary px-4" id="btnGo">Go</button>
            </div>
        </div>

        <!-- ✅ Tabs -->
        <ul class="nav nav-tabs" id="attendanceTabs" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" data-toggle="tab" href="#firstLast" role="tab">First In and Last Out</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-toggle="tab" href="#multiplePunches" role="tab">Multiple Punches</a>
            </li>
        </ul>

        <div class="tab-content mt-3">
            <div class="tab-pane fade show active" id="firstLast" role="tabpanel">
                <div id="dxFirstLastGrid"></div>
            </div>
            <div class="tab-pane fade" id="multiplePunches" role="tabpanel">
                <div id="dxMultipleGrid"></div>
            </div>
        </div>
    </div>
</div>

<!-- ✅ Required Scripts -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- ✅ DevExtreme Scripts -->
<link href="https://cdn3.devexpress.com/jslib/23.1.3/css/dx.light.css" rel="stylesheet" />
<script src="https://cdn3.devexpress.com/jslib/23.1.3/js/dx.all.js"></script>

<script>
    const baseUrl = '@baseUrl';
    const empid = 1;

    $(document).ready(function () {
        $('#btnGo').click(function () {
            const month = $('#dropdownmonth').val();
            const year = $('#dropdownyear').val();

            if (!month || !year) {
                Swal.fire("Please select both Month and Year.");
                return;
            }

            const activeTab = $(".nav-link.active").attr("href");
            if (activeTab === "#firstLast") {
                loadFirstLast(empid, month, year);
            } else {
                loadMultiple(empid, month, year);
            }
        });

        $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
            const target = $(e.target).attr("href");
            const month = $('#dropdownmonth').val();
            const year = $('#dropdownyear').val();

            if (!month || !year) return;

            if (target === "#firstLast") {
                loadFirstLast(empid, month, year);
            } else {
                loadMultiple(empid, month, year);
            }
        });

        function loadFirstLast(empid, month, year) {
            $.ajax({
                url: baseUrl + "/EmployeeInOut/AttendanceFirstInOutReport",
                type: "POST",
                data: { empid, month, year },
                success: function (response) {
                    $("#dxFirstLastGrid").dxDataGrid("dispose").dxDataGrid({
                        dataSource: response.data || [],
                        columns: [
                            { dataField: "for_Date", caption: "Date", dataType: "date", format: "dd/MM/yyyy" },
                            { dataField: "day_Name", caption: "Day" },
                            { dataField: "in_Time", caption: "In Time" },
                            { dataField: "out_Time", caption: "Out Time" },
                            { dataField: "duration", caption: "Duration" }
                        ],
                        showBorders: true,
                        columnAutoWidth: true,
                        paging: { pageSize: 10 },
                        pager: {
                            showPageSizeSelector: true,
                            allowedPageSizes: [5, 10, 20],
                            showInfo: true
                        },
                        noDataText: "No data found."
                    });
                },
                error: function () {
                    Swal.fire("❌ Failed to load First In/Out records.");
                }
            });
        }

        function loadMultiple(empid, month, year) {
            $.ajax({
                url: baseUrl + "/EmployeeInOut/AttendanceInOutReport",
                type: "POST",
                data: { empid, month, year },
                success: function (response) {
                    $("#dxMultipleGrid").dxDataGrid("dispose").dxDataGrid({
                        dataSource: response.data || [],
                        columns: [
                            { dataField: "for_Date", caption: "Date", dataType: "date", format: "dd/MM/yyyy" },
                            { dataField: "day_Name", caption: "Day" },
                            { dataField: "in_Time", caption: "In Time" },
                            { dataField: "out_Time", caption: "Out Time" },
                            { dataField: "duration", caption: "Duration" }
                        ],
                        showBorders: true,
                        columnAutoWidth: true,
                        paging: { pageSize: 10 },
                        pager: {
                            showPageSizeSelector: true,
                            allowedPageSizes: [5, 10, 20],
                            showInfo: true
                        },
                        noDataText: "No data found."
                    });
                },
                error: function () {
                    Swal.fire("❌ Failed to load Multiple In/Out records.");
                }
            });
        }
    });
</script>
