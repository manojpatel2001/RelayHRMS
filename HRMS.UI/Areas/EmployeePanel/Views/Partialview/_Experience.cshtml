@inject IConfiguration Configuration
@{
    // Layout = null;
    string baseUrl = Configuration["BaseUrlSettings:baseUrl"];
    var uri = new Uri(baseUrl);
    string baseDomainUrl = $"{uri.Scheme}://{uri.Host}:{uri.Port}";
    string UIBaseUrl = Configuration["UIBaseUrlSettings:baseUrl"];


}
<!--Experience & Language-->
<div id="Experience-Language-form" class="form-section">
    <div class="row">
        <!-- Experience -->
        <div class="col-md-8">
            <div class="form-heading">Experience In Previous Organization</div>

            <!-- Employer / Branch -->
            <div class="row mb-2">
                <div class="col-md-6 form-group-custom">
                    <label class="form-label-fixed mb-0">Employer:</label>
                    <input type="text" class="form-control form-control-sm">
                </div>
                <div class="col-md-6 form-group-custom">
                    <label class="form-label-fixed mb-0">Branch :</label>
                    <input type="text" class="form-control form-control-sm">
                </div>
            </div>

            <!-- Location / Designation -->
            <div class="row mb-2">
                <div class="col-md-6 form-group-custom">
                    <label class="form-label-fixed mb-0">Location :</label>
                    <input type="text" class="form-control form-control-sm">
                </div>
                <div class="col-md-6 form-group-custom">
                    <label class="form-label-fixed mb-0">Designation:</label>
                    <input type="text" class="form-control form-control-sm">
                </div>
            </div>

            <!-- Start / End Date -->
            <div class="row mb-2">
                <div class="col-md-6 form-group-custom">
                    <label class="form-label-fixed mb-0">Start Date :</label>
                    <input type="date" class="form-control form-control-sm">
                </div>
                <div class="col-md-6 form-group-custom">
                    <label class="form-label-fixed mb-0">End Date:</label>
                    <input type="date" class="form-control form-control-sm">
                </div>
            </div>

            <!-- CTC / Gross Salary -->
            <div class="row mb-2">
                <div class="col-md-6 form-group-custom">
                    <label class="form-label-fixed mb-0">CTC :</label>
                    <input type="text" class="form-control form-control-sm">
                </div>
                <div class="col-md-6 form-group-custom">
                    <label class="form-label-fixed mb-0">Gross Salary:</label>
                    <input type="text" class="form-control form-control-sm">
                </div>
            </div>

            <!-- Manager / Contact -->
            <div class="row mb-2">
                <div class="col-md-6 form-group-custom">
                    <label class="form-label-fixed mb-0">Manager :</label>
                    <input type="text" class="form-control form-control-sm">
                </div>
                <div class="col-md-6 form-group-custom">
                    <label class="form-label-fixed mb-0">Manager Contact No.:</label>
                    <input type="text" class="form-control form-control-sm">
                </div>
            </div>

            <!-- Remarks / Industry -->
            <div class="row mb-2">
                <div class="col-md-6 form-group-custom">
                    <label class="form-label-fixed mb-0">Remarks :</label>
                    <input type="text" class="form-control form-control-sm">
                </div>
                <div class="col-md-6 form-group-custom">
                    <label class="form-label-fixed mb-0">Industry Type:</label>
                    <input type="text" class="form-control form-control-sm">
                </div>
            </div>

            <!-- Attach Documents -->
            <div class="row mb-3">
                <div class="col-md-12 form-group-custom">
                    <label class="form-label-fixed mb-0">Attach Documents :</label>
                    <input type="file" class="form-control form-control-sm">
                </div>
            </div>

            <!-- Submit Button -->
            <div class="text-center mb-3">
                <button class="btn btn-primary btn-sm" id="btnAddExperience">Submit</button>
            </div>

            <div class="form-heading">Experience :</div>
        </div>

        <!-- Language -->
        <div class="col-md-4" style="border-left: 1px solid #ccc;">
            <div class="form-heading">Language</div>

            <!-- Language Selection -->
            <div class="form-group-custom mb-2">
                <label class="form-label-fixed mb-0">Language :</label>
                <select id="txtLanguage" class="form-select form-select-sm">
                    <option value="">--Select--</option>
                    <option value="English">English</option>
                    <option value="Hindi">Hindi</option>
                    <option value="Gujarati">Gujarati</option>
                </select>
            </div>

            <!-- Fluency -->
            <div class="form-group-custom mb-2">
                <label class="form-label-fixed mb-0">Fluency:</label>
                <input type="text" id="txtFluency" class="form-control form-control-sm">
            </div>

            <!-- Ability -->
            <div class="mb-4">
                <label class="form-label-fixed mb-1">Ability:</label>
                <div class="d-flex flex-wrap gap-3 ms-3">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="chkWrite">
                        <label class="form-check-label" for="chkWrite">Write</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="chkRead">
                        <label class="form-check-label" for="chkRead">Read</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="chkSpeak">
                        <label class="form-check-label" for="chkSpeak">Speak</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="chkUnderstand">
                        <label class="form-check-label" for="chkUnderstand">Understand</label>
                    </div>
                </div>
            </div>

            <!-- Submit -->
            <div class="text-center mb-3">
                <button  id="btnAddLanguage" class="btn btn-primary " style="background-color:#394867 !important">Submit</button>
            </div>

            <div class="form-heading">Language Details :</div>
            <div class="container mt-3">

                <div id="grid-loader"
                     class="grid-loader justify-content-center align-items-center flex-column"
                     style="display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
                     background: rgba(255, 255, 255, 0.6); backdrop-filter: blur(3px); z-index: 9999;">

                    <img src="@baseDomainUrl/loders/loder.png"
                         class="grid-logo-spinner"
                         style="width: 40px; height: 40px; animation: spin 1s linear infinite;" />

                    <div class="grid-loading-text text-dark " style="font-size: 16px;">Loading...</div>
                </div>

                <!-- Grid Container with full width -->
                <div class="grid-container">
                    <div id="leaveBalanceGrid"></div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="container mt-3">

    <div id="grid-loader"
         class="grid-loader justify-content-center align-items-center flex-column"
         style="display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: rgba(255, 255, 255, 0.6); backdrop-filter: blur(3px); z-index: 9999;">

        <img src="@baseDomainUrl/loders/loder.png"
             class="grid-logo-spinner"
             style="width: 40px; height: 40px; animation: spin 1s linear infinite;" />


        <div class="grid-loading-text text-dark " style="font-size: 16px;">Loading...</div>
    </div>

    <!-- Grid Container with full width -->
    <div class="grid-container">
        <div id="leaveBalanceGrid"></div>
    </div>
</div>

<script>
    const empid = parseInt(localStorage.getItem("EmployeeId"));
    let LanguageId = 0;

    $('#btnAddLanguage').click(function () {
        $(this).prop("disabled", true);

        const getValueOrNull = id => {
            const val = $(id).val()?.trim();
            return val === '' ? null : val;
        };

        const languageModel = {
            LanguageId: LanguageId || 0,
            EmployeeId: empid,
            LanguageName: getValueOrNull('#txtLanguage'),
            Fluency: getValueOrNull('#txtFluency'),
            CanWrite: $('#chkWrite').is(":checked"),
            CanRead: $('#chkRead').is(":checked"),
            CanSpeak: $('#chkSpeak').is(":checked"),
            CanUnderstand: $('#chkUnderstand').is(":checked"),
            CreatedBy: localStorage.getItem('loggedInUser') || "Admin"
        };

        const apiConfig = {
            url: LanguageId === 0
                ? '@baseUrl/EmployeeProfileLanguageAPI/AddEmployeeProfileLanguage'
                : '@baseUrl/EmployeeProfileLanguageAPI/UpdateEmployeeProfileLanguage',
            method: LanguageId === 0 ? 'POST' : 'PUT'
        };

        $.ajax({
            url: apiConfig.url,
            method: apiConfig.method,
            headers: {
                'Authorization': 'Bearer ' + token,
                'Content-Type': 'application/json'
            },
            data: JSON.stringify(languageModel),
             success: function (response) {
        console.log("API Response:", response);

        if (response.isSuccess) {
           
            round_success_noti(response.responseMessage);
            loadGrid(response.data || response.Data || []);
            LanguageId = 0;
            $('#Language-form').trigger("reset");
        } else {
            round_error_noti(response.responseMessage);
        }
        $('#btnAddLanguage').prop("disabled", false);
    },

            error: function () {
                round_error_noti("Something went wrong while saving.");
                $('#btnAddLanguage').prop("disabled", false);
            }
        });
    });

    function loadGrid(data) {
        debugger;
        $("#leaveBalanceGrid").dxDataGrid({

            dataSource: data,
            showBorders: true,
            height: "auto",
            width: "100%",
            columnAutoWidth: true,
            paging: { enabled: true, pageSize: 10 },
            pager: { showPageSizeSelector: true, allowedPageSizes: [5, 10, 20] },
            allowColumnResizing: true,
            columns: [
                { dataField: "languageName", caption: "Language" },
                { dataField: "fluency", caption: "Fluency" },
                { dataField: "canRead", caption: "Read" },
                { dataField: "canWrite", caption: "Write" },
                { dataField: "canSpeak", caption: "Speak" },
                { dataField: "canUnderstand", caption: "Understand" }
            ]
        });
    }
</script>


