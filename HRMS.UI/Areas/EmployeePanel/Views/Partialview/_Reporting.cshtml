@inject IConfiguration Configuration
@{
    string baseUrl = Configuration["BaseUrlSettings:baseUrl"];
}
<style>
    .table-responsive-fixed {
        max-height: 300px; /* Maximum height for scroll */
        min-height: auto;
        overflow-y: auto;
        overflow-x: hidden;
        border: 1px solid #dee2e6;
        border-radius: 0.375rem;
    }

        /* Fixed header styling */
        .table-responsive-fixed thead th {
            position: sticky;
            top: 0;
            background-color: #394867 !important;
            color: white !important;
            z-index: 10;
            border-bottom: 2px solid #394867;
            font-weight: 600;
        }

        /* Ensure table maintains its styling */
        .table-responsive-fixed .table {
            margin-bottom: 0;
        }

            .table-responsive-fixed .table td {
                vertical-align: middle;
            }



        /* Custom scrollbar for better appearance */
        .table-responsive-fixed::-webkit-scrollbar {
            width: 5px;
        }

        .table-responsive-fixed::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .table-responsive-fixed::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }

            .table-responsive-fixed::-webkit-scrollbar-thumb:hover {
                background: #555;
            }
</style>

<div class="row">
    <div class="col-sm-6">
        <div class=" border border-dark border-1 rounded">
            <div class="card-header bg-primary text-white">
                <h6>REPORTING MANAGER</h6>
            </div>

            <div class="card-body">
             
                <div class="row">
                    <div class="col-md-12 ">
                        <div class="table-responsive table-responsive-fixed">
                            <table class="table table-bordered" id="tableReportingManger">
                                <thead style="background:#394867;">
                                    <tr>
                                        <th >Manager Name</th>
                                        <th >Method</th>
                                        <th>Effected Date</th>
                                        
                                    </tr>
                                </thead>
                                <tbody id="tableReportingMangerBody">
                                    <!-- Sample data for demonstration -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

            </div>
        </div> <!-- End outer card -->
    </div>

    <div class="col-sm-6">
        <div class="border border-dark border-1 rounded">
            <div class="card-header bg-primary text-white">
                <h6>CONTRACT</h6>
            </div>
            <div class="card-body">
                
                <div class="row">
                    <div class="col-md-12 ">
                        <div class="table-responsive table-responsive-fixed">
                            <table class="table table-bordered" id="tableContract">
                                <thead style="background:#394867;">
                                    <tr>
                                        <th>Project Name</th>
                                        <th>Start Date</th>
                                        <th>End Date</th>
                                        <th>Comments</th>
                                        <th>Renew</th>
                                        <th>Reminder</th>
                                        
                                    </tr>
                                </thead>
                                <tbody id="tableContractBody">
                                    <!-- Sample data for demonstration -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>


<script>

     $(document).ready(function () {
        loadContractDetails();
        loadReportingDetails();

    });

    function formatDate(isoDateStr) {
            if (!isoDateStr) return '';
      return isoDateStr.split('T')[0];
    }

   
      async function loadReportingDetails() {
        try {

            const response = await fetch('@baseUrl/ReportingManagerDetailsAPI/GetAllReportingManagerDetails/' + employeeId, {
                method: 'GET',
                headers: {
                    'Accept': 'application/json'
                }
            });
                if (!response.ok) {
                        console.log('HTTP error! Status: ' + response.status);
                 }
            const data = await response.json();

            let tbody = $('#tableReportingMangerBody');
            tbody.empty();

            if (data.isSuccess && data.data.length > 0) {
                reportingDetails=data.data;
                data.data.forEach(row => {
                    const createdDate = formatToDDMMYYYY(row.createdDate);
                    const effectedDate = formatToDDMMYYYY(row.effectedDate);
                    const fileLink = row.documentUrl ? `<a href="${row.documentUrl}" target="_blank">View</a>` : 'N/A';

                    tbody.append(`
                        <tr>
                            <td>${row.employeeCode ?? ''} ${row.reportingManagerName ?? ''}</td>
                        <td>${row.methodName ?? ''}</td>
                        <td>${effectedDate}</td>
                        
                        </tr>
                    `);
                });
            } else {
                tbody.append('<tr><td colspan="6" class="text-center">No data found.</td></tr>');
            }

        } catch (error) {
            console.error('Fetch error:', error);
        }
    }

   
 
   

     async function loadContractDetails() {
        try {
            const response = await fetch('@baseUrl/ContractDetailsAPI/GetAllContractDetails/' + employeeId, {
                method: 'GET',
                headers: {
                    'Accept': 'application/json'
                }
            });

            if (!response.ok) {
                console.error('HTTP error! Status: ' + response.status);
                return;
            }

            const data = await response.json();
            const tbody = $('#tableContractBody');
            tbody.empty();

            if (data.isSuccess && data.data.length > 0) {
                ContractDetails=data.data;
                data.data.forEach(row => {
                        const startDate = formatToDDMMYYYY(row.startDate);
                           const endDate = formatToDDMMYYYY(row.endDate);


                    tbody.append(`
                        <tr>
                            <td>${row.projectName ?? '-'}</td>
                            <td>${startDate}</td>
                            <td>${endDate}</td>
                            <td>${row.comment ?? '-'}</td>
                            <td>${row.isRenew ? 'Yes' : 'No'}</td>
                            <td>${row.isContractRenew ? 'Yes' : 'No'}</td>
                            
                        </tr>
                    `);
                });
            } else {
                tbody.append('<tr><td colspan="8" class="text-center">No data found.</td></tr>');
            }
        } catch (error) {
            console.error('Fetch error:', error);
        }
    }

     function formatToDDMMYYYY(dateInput) {
        const date = new Date(dateInput);
        const day = String(date.getDate()).padStart(2, '0');
        const month = String(date.getMonth() + 1).padStart(2, '0'); // Months are 0-based
        const year = date.getFullYear();
        return `${day}/${month}/${year}`;
    }

</script>
