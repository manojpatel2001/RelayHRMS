@inject IConfiguration Configuration
@{
    ViewData["Title"] = "Employee Panel";
    Layout = "~/Areas/EmployeePanel/Views/Shared/_EmployeeLayout.cshtml";
    string baseUrl = Configuration["BaseUrlSettings:baseUrl"];
    var uri = new Uri(baseUrl);
    string baseDomainUrl = $"{uri.Scheme}://{uri.Host}:{uri.Port}";
    string UIBaseUrl = Configuration["UIBaseUrlSettings:baseUrl"];
}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<title>Salary Dashboard</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f8fafc;
        color: #334155;
        width: 100%;
        overflow-x: auto;
        margin: 0;
        padding: 0;
    }

    .container {
        width: 100%;
        max-width: none;
        margin: 0;
        padding: 0;
        min-height: 100vh;
    }

    /* Header */
    .header {
        background: white;
        border-bottom: 1px solid #e2e8f0;
        margin: 0;
        border-radius: 0;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        width: 100%;
    }

    .header-content {
        padding: 8px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .header h1 {
        color: #1e293b;
        font-size: 20px;
        font-weight: 600;
        margin: 0;
    }

    .breadcrumb {
        color: #64748b;
        font-size: 14px;
    }

    /* Dashboard Grid - Two columns equal width */
    .dashboard-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin: 10px 15px 15px 15px;
        width: calc(100% - 30px);
    }

    /* Cards */
    .card {
        background: white;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        border: 1px solid #e2e8f0;
        width: 100%;
        height: auto; /* Changed from min-height to auto */
        display: flex;
        flex-direction: column;
    }

        /* Regular cards minimum height */
        .card:not(.yearly-card) {
            min-height: 350px;
        }

    .card-header {
        padding: 10px 20px;
        border-bottom: 1px solid #e2e8f0;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-shrink: 0;
    }

        .card-header h2 {
            font-size: 16px;
            font-weight: 600;
            color: #1e293b;
            margin: 0;
        }

    .card-content {
        padding: 12px 20px;
        flex: 1;
        /* Removed overflow-y: auto to disable scrolling */
    }

        /* Scrollable content for specific cards that need it */
        .card-content.scrollable {
            overflow-y: auto;
        }

    /* Calculated Days */
    .days-legend {
        display: flex;
        gap: 15px;
        margin-bottom: 12px;
        font-size: 12px;
        flex-wrap: wrap;
    }

    .legend-item {
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .legend-color {
        width: 8px;
        height: 8px;
        border-radius: 50%;
    }

    .present-days-info {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 12px;
        font-weight: 600;
    }

    .present-indicator {
        width: 12px;
        height: 12px;
        background: #3b82f6;
        border-radius: 50%;
    }

    .days-bar {
        margin-bottom: 10px;
    }

    .days-bar-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 5px;
        font-size: 14px;
    }

    .bar-container {
        height: 20px;
        background: #f1f5f9;
        border-radius: 4px;
        display: flex;
        overflow: hidden;
        width: 100%;
    }

    .bar-segment {
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 10px;
        font-weight: 600;
        color: white;
    }

    .bar-present {
        background: #3b82f6;
    }

    .bar-holiday {
        background: #ff9500; /* Orange color */
    }

    .bar-weekoff {
        background: #06b6d4;
    }

    /* Tooltip styles */
    .tooltip {
        position: absolute;
        background: #1f2937;
        color: white;
        padding: 8px 12px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 500;
        pointer-events: none;
        z-index: 1000;
        opacity: 0;
        transition: opacity 0.2s;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

        .tooltip.show {
            opacity: 1;
        }

        .tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border: 5px solid transparent;
            border-top-color: #1f2937;
        }

    /* Chart */
    .chart-container {
        position: relative;
        height: 200px;
        margin-top: 8px;
        width: 100%;
        flex: 1;
    }

    .chart-legend {
        display: flex;
        gap: 20px;
        margin-top: 8px;
        font-size: 14px;
        flex-wrap: wrap;
    }

    /* Yearly Table - UPDATED STYLES */
    .yearly-card {
        grid-column: 1 / -1;
        width: calc(100% - 30px);
        margin: 0 15px 15px 15px;
        height: auto; /* Natural height */
        min-height: auto; /* Remove minimum height constraint */
    }

        .yearly-card .card-header {
            padding: 6px 20px;
        }

        /* Remove excess padding and set proper height for yearly card content */
        .yearly-card .card-content {
            padding: 6px 20px 8px 20px; /* Reduced bottom padding to 8px */
            height: auto; /* Natural height */
            min-height: auto; /* Remove minimum height */
        }

    /* Ensure the grid container doesn't add extra space */
    #gridContainer {
        margin: 0;
        padding: 0;
        height: auto;
        min-height: auto;
    }

        /* Make sure the DevExtreme grid doesn't add extra height */
        #gridContainer .dx-datagrid {
            height: auto !important;
            min-height: auto !important;
        }

        /* Remove any extra space from the DevExtreme wrapper */
        #gridContainer .dx-datagrid-wrapper {
            height: auto !important;
            min-height: auto !important;
        }

        /* Ensure the DevExtreme grid container is tight */
        #gridContainer .dx-datagrid-container {
            padding: 0 !important;
            margin: 0 !important;
        }

        /* Remove bottom margin from DevExtreme scrollable */
        #gridContainer .dx-scrollable {
            margin-bottom: 0 !important;
        }

        /* Ensure no extra space in grid rows area */
        #gridContainer .dx-datagrid-rows {
            margin-bottom: 0 !important;
            padding-bottom: 0 !important;
        }

    .year-selector {
        padding: 4px 8px;
        border: 1px solid #d1d5db;
        border-radius: 4px;
        background: white;
        font-size: 14px;
    }

    .salary-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 8px;
        min-width: 800px;
    }

        .salary-table th,
        .salary-table td {
            padding: 8px 10px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
            font-size: 13px;
            white-space: nowrap;
        }

        .salary-table th {
            background: #f8fafc;
            font-weight: 600;
            color: #374151;
        }

        .salary-table td {
            color: #6b7280;
        }

        .salary-table tr:hover {
            background: #f8fafc;
        }

    .net-amount-row {
        background: #eff6ff !important;
        font-weight: 600;
    }

        .net-amount-row td {
            color: #1e293b;
        }

    /* Loading */
    .loading {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 200px;
        width: 100%;
    }

    .spinner {
        width: 40px;
        height: 40px;
        border: 4px solid #e2e8f0;
        border-top: 4px solid #3b82f6;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @@keyframes spin {
        0%

    {
        transform: rotate(0deg);
    }

    100% {
        transform: rotate(360deg);
    }

    }

    .hidden {
        display: none;
    }

    .text-center {
        text-align: center;
    }

    .overflow-x-auto {
        overflow-x: auto;
        width: 100%;
    }

    /* Responsive utilities */
    .responsive-header {
        flex-wrap: wrap;
        justify-content: center;
        gap: 15px;
    }

    .responsive-legends {
        justify-content: center;
        flex-wrap: wrap;
    }

    /* Compact table styles */
    .compact-table th,
    .compact-table td {
        padding: 6px 8px;
        font-size: 12px;
    }

    /* Mobile responsive adjustments */
    @@media (max-width: 768px) {
        .container

    {
        padding: 0;
    }

    .header-content {
        padding: 8px 15px;
    }

    .header h1 {
        font-size: 18px;
    }

    .dashboard-grid {
        grid-template-columns: 1fr;
        gap: 12px;
        margin: 8px 12px 12px 12px;
        width: calc(100% - 24px);
    }

    .card {
        height: auto;
    }

        .card:not(.yearly-card) {
            min-height: 300px;
        }

    .card-header {
        padding: 8px 15px;
    }

        .card-header h2 {
            font-size: 15px;
        }

    .card-content {
        padding: 10px 15px;
    }

    .chart-container {
        height: 180px;
    }

    .yearly-card {
        margin: 0 12px 12px 12px;
        width: calc(100% - 24px);
    }

        .yearly-card .card-header {
            padding: 6px 15px;
        }

        .yearly-card .card-content {
            padding: 6px 15px 6px 15px; /* Even more compact on mobile */
        }

    .days-legend {
        margin-bottom: 10px;
    }

    .present-days-info {
        margin-bottom: 10px;
    }

    .days-bar {
        margin-bottom: 8px;
    }

    .chart-legend {
        margin-top: 6px;
    }

    }
</style>

<div class="container">
    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <h1>Salary Dashboard</h1>
        </div>
    </div>

    <!-- Loading State -->
    <div id="loading" class="loading">
        <div class="spinner"></div>
    </div>

    <!-- Dashboard Content -->
    <div id="dashboard" class="hidden">
        <!-- Main Grid - Two columns -->
        <div class="dashboard-grid" id="dashboardGrid">
            <!-- Calculated Days -->
            <div class="card">
                <div class="card-header">
                    <h2>Calculated Salary Days</h2>
                </div>
                <div class="card-content">
                    <div class="present-days-info">
                        <div class="present-indicator"></div>
                        <span>Present Days: <span id="currentPresentDays">0</span></span>
                    </div>

                    <div class="days-legend responsive-legends">
                        <div class="legend-item">
                            <div class="legend-color" style="background: #3b82f6;"></div>
                            <span>Present Days</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #06b6d4;"></div>
                            <span>Weekoff Days</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #ff9500;"></div>
                            <span>Holiday Days</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #ef4444;"></div>
                            <span>Total Leave Days</span>
                        </div>
                    </div>

                    <div id="daysContainer">
                        <!-- Days bars will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Salary Chart -->
            <div class="card">
                <div class="card-header">
                    <h2>Salary Summary of Last 6 Months</h2>
                </div>
                <div class="card-content">
                    <div class="chart-legend responsive-legends">
                        <div class="legend-item">
                            <div class="legend-color" style="background: #3b82f6;"></div>
                            <span>Net Salary</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #10b981;"></div>
                            <span>Gross Salary</span>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="salaryChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Yearly Salary Table -->
        <div class="card yearly-card">
            <div class="card-header">
                <h2>Yearly Salary</h2>
                <select id="yearSelector" class="year-selector">
                    <!-- Years will be populated dynamically here -->
                </select>
            </div>
            <div class="card-content">
                <div id="gridContainer"></div>
            </div>
        </div>
    </div>
</div>

<script>
    const savedCompany = localStorage.getItem('selectedCompany');
    var companyDetails = savedCompany ? JSON.parse(savedCompany) : null;
    const Compid = companyDetails ? companyDetails.CompanyId : null;
    const EmployeeId = localStorage.getItem('EmployeeId');
    const Token = localStorage.getItem("authToken");

    // Global variables
    let salaryChart;
    let dashboardData = {};

    // Initialize dashboard
    document.addEventListener('DOMContentLoaded', function() {
        setupResponsiveLayout();
        loadDashboardData();
        fetchYearlySalaryReport(EmployeeId);
        populateYearDropdown();
        fetchSalaryData(EmployeeId);
    });

    $('#yearSelector').change(function() {
        const selectedYear = $(this).val();
        if (selectedYear) {
            fetchYearlySalaryReport(EmployeeId);
        }
    });

    function renderTable(data) {
        $("#gridContainer").dxDataGrid({
            dataSource: data,
            showBorders: true,
            columnAutoWidth: true,
            allowColumnReordering: true,
            allowColumnResizing: true,
            columnResizingMode: "widget",
             height: 'auto',
               paging: {
            enabled: false // Disable paging to show all rows
        },
            scrolling: {
                mode: "standard",
                useNative: true
            },
            columnFixing: {
                enabled: true
            },
            columns: [
                {
                    dataField: "salaryHead",
                    caption: "Salary Head",
                    cssClass: "text-center-cell",
                    format: { type: "fixedPoint", precision: 2 },
                    cellTemplate: function(container, options) {
                        container.css("font-weight", "700");
                        container.css("background-color", "#f8f9fa");
                        container.text(options.value);
                    }
                },
                { dataField: "jan", caption: "Jan", cssClass: "text-center-cell", format: { type: "fixedPoint", precision: 2 } },
                { dataField: "feb", caption: "Feb", cssClass: "text-center-cell", format: { type: "fixedPoint", precision: 2 } },
                { dataField: "mar", caption: "Mar", cssClass: "text-center-cell", format: { type: "fixedPoint", precision: 2 } },
                { dataField: "apr", caption: "Apr", cssClass: "text-center-cell", format: { type: "fixedPoint", precision: 2 } },
                { dataField: "may", caption: "May", cssClass: "text-center-cell", format: { type: "fixedPoint", precision: 2 } },
                { dataField: "jun", caption: "Jun", cssClass: "text-center-cell", format: { type: "fixedPoint", precision: 2 } },
                { dataField: "jul", caption: "Jul", cssClass: "text-center-cell", format: { type: "fixedPoint", precision: 2 } },
                { dataField: "aug", caption: "Aug", cssClass: "text-center-cell", format: { type: "fixedPoint", precision: 2 } },
                { dataField: "sep", caption: "Sep", cssClass: "text-center-cell", format: { type: "fixedPoint", precision: 2 } },
                { dataField: "oct", caption: "Oct", cssClass: "text-center-cell", format: { type: "fixedPoint", precision: 2 } },
                { dataField: "nov", caption: "Nov", cssClass: "text-center-cell", format: { type: "fixedPoint", precision: 2 } },
                { dataField: "dec", caption: "Dec", cssClass: "text-center-cell", format: { type: "fixedPoint", precision: 2 } }
            ]
        });
    }

    function populateYearDropdown() {
        const startYear = 2024;
        const currentYear = new Date().getFullYear();
        const yearDropdown = $("#yearSelector");
        yearDropdown.empty();
        yearDropdown.append('<option value="">--Select--</option>');
        for (let year = currentYear; year >= startYear; year--) {
            yearDropdown.append(`<option value="${year}">${year}</option>`);
        }

        // Set default year to 2025
        yearDropdown.val('2025');
    }

    function setupResponsiveLayout() {
        function checkScreenSize() {
            const dashboardGrid = document.getElementById('dashboardGrid');
            const headerContent = document.querySelector('.header-content');

            if (window.innerWidth <= 768) {
                // Mobile layout - single column
                headerContent.classList.add('responsive-header');

                // Make table compact on mobile
                const table = document.querySelector('.salary-table');
                if (table) {
                    table.classList.add('compact-table');
                }

                // Adjust chart height
                const chartContainer = document.querySelector('.chart-container');
                if (chartContainer) {
                    chartContainer.style.height = '180px';
                }
            } else {
                // Desktop layout - two columns
                headerContent.classList.remove('responsive-header');

                const table = document.querySelector('.salary-table');
                if (table) {
                    table.classList.remove('compact-table');
                }

                const chartContainer = document.querySelector('.chart-container');
                if (chartContainer) {
                    chartContainer.style.height = '200px';
                }
            }
        }

        // Check on load and resize
        checkScreenSize();
        window.addEventListener('resize', checkScreenSize);
    }

    // Load data function
    async function loadDashboardData() {
        try {
            // Show loading
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('dashboard').classList.add('hidden');

            // Wait for API data to be fetched
            await new Promise(resolve => setTimeout(resolve, 500));

            // Hide loading and show dashboard
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');

        } catch (error) {
            console.error('Error loading dashboard data:', error);
            alert('Error loading dashboard data. Please try again.');
        }
    }

    // Process API response and render calculated days
    function processAndRenderCalculatedDays(apiData) {
        if (!apiData || !Array.isArray(apiData) || apiData.length === 0) {
            document.getElementById('currentPresentDays').textContent = '0';
            document.getElementById('daysContainer').innerHTML = '<p class="text-center">No data available</p>';
            return;
        }

        // Sort data by year and month number to ensure proper order
        const sortedData = apiData.sort((a, b) => {
            if (a.year !== b.year) {
                return a.year - b.year;
            }
            return a.monthNumber - b.monthNumber;
        });

        // Get the latest month data for current present days
        const latestMonth = sortedData[sortedData.length - 1];
        document.getElementById('currentPresentDays').textContent = latestMonth.presentDays || 0;

        // Render days bars
        const container = document.getElementById('daysContainer');
        container.innerHTML = sortedData.map(item => {
            const total = item.totalDays || 30;
            const presentWidth = (item.presentDays / total) * 100;
            const weekoffWidth = (item.weekOffDays / total) * 100;
            const holidayWidth = (item.holidayDays / total) * 100;
            const leaveWidth = (item.leaveDays / total) * 100;

            return `
                <div class="days-bar">
                    <div class="days-bar-header">
                        <span>${item.month}</span>
                        <span>${item.presentDays || 0}</span>
                    </div>
                    <div class="bar-container">
                        ${item.presentDays > 0 ? `<div class="bar-segment bar-present"
                             style="width: ${presentWidth}%"
                             onmouseover="showTooltip(event, 'Present Days: ${item.presentDays}')"
                             onmouseout="hideTooltip()">
                            ${item.presentDays}
                        </div>` : ''}
                        ${item.weekOffDays > 0 ? `<div class="bar-segment bar-weekoff"
                             style="width: ${weekoffWidth}%"
                             onmouseover="showTooltip(event, 'Weekoff Days: ${item.weekOffDays}')"
                             onmouseout="hideTooltip()">
                            ${item.weekOffDays}
                        </div>` : ''}
                        ${item.holidayDays > 0 ? `<div class="bar-segment bar-holiday"
                             style="width: ${holidayWidth}%"
                             onmouseover="showTooltip(event, 'Holiday Days: ${item.holidayDays}')"
                             onmouseout="hideTooltip()">
                            ${item.holidayDays}
                        </div>` : ''}
                        ${item.leaveDays > 0 ? `<div class="bar-segment bar-leave"
                             style="width: ${leaveWidth}%"
                             onmouseover="showTooltip(event, 'Leave Days: ${item.leaveDays}')"
                             onmouseout="hideTooltip()">
                            ${item.leaveDays}
                        </div>` : ''}
                    </div>
                </div>
            `;
        }).join('');
    }

    // Tooltip functions
    function showTooltip(event, text) {
        let tooltip = document.getElementById('customTooltip');
        if (!tooltip) {
            tooltip = document.createElement('div');
            tooltip.id = 'customTooltip';
            tooltip.className = 'tooltip';
            document.body.appendChild(tooltip);
        }

        tooltip.textContent = text;
        tooltip.style.left = event.pageX + 10 + 'px';
        tooltip.style.top = event.pageY - 40 + 'px';
        tooltip.classList.add('show');
    }

    function hideTooltip() {
        const tooltip = document.getElementById('customTooltip');
        if (tooltip) {
            tooltip.classList.remove('show');
        }
    }

    // Process API response and render salary chart
    function processAndRenderSalaryChart(apiData) {
        if (!apiData || !Array.isArray(apiData) || apiData.length === 0) {
            return;
        }

        // Sort data by year and month number to ensure proper order
        const sortedData = apiData.sort((a, b) => {
            if (a.year !== b.year) {
                return a.year - b.year;
            }
            return a.monthNumber - b.monthNumber;
        });

        // Take last 6 months for the chart
        const last6Months = sortedData.slice(-6);

        const ctx = document.getElementById('salaryChart');
        if (!ctx) return;

        // Destroy existing chart if it exists
        if (salaryChart) {
            salaryChart.destroy();
        }

        const months = last6Months.map(item => item.month);
        const netSalaries = last6Months.map(item => item.netSalary || 0);
        const grossSalaries = last6Months.map(item => item.grossSalary || 0);

        salaryChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: months,
                datasets: [
                    {
                        label: 'Net Salary',
                        data: netSalaries,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    },
                    {
                        label: 'Gross Salary',
                        data: grossSalaries,
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: {
                    intersect: false,
                },
                plugins: {
                    legend: {
                        display: false // We're using custom legend
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.dataset.label + ': ₹' + context.parsed.y.toLocaleString('en-IN');
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        display: true,
                        grid: {
                            display: false
                        }
                    },
                    y: {
                        display: true,
                        grid: {
                            color: '#f1f5f9'
                        },
                        ticks: {
                            callback: function(value) {
                                return '₹' + value.toLocaleString('en-IN');
                            }
                        }
                    }
                }
            }
        });
    }

    // Updated fetchSalaryData function
    function fetchSalaryData(EmployeeId) {
        $.ajax({
            url: '@(baseDomainUrl + "/api/MonthlySalaryDetailsAPI/GetEmployeeSalaryDays")',
            type: 'GET',
            data: {
                EmployeeId: EmployeeId
            },
            contentType: 'application/json',
            success: function (res) {
                console.log("res", res);
                if (res.isSuccess && res.data) {
                    // Process and render the calculated days card
                    processAndRenderCalculatedDays(res.data);

                    // Process and render the salary chart
                    processAndRenderSalaryChart(res.data);

                    // Store data globally if needed
                    dashboardData.apiData = res.data;

                } else {
                    if (typeof round_error_noti === 'function') {
                        round_error_noti(res.responseMessage || 'No Data Found');
                    } else {
                        alert(res.responseMessage || 'No Data Found');
                    }
                    // Render empty states
                    processAndRenderCalculatedDays([]);
                    processAndRenderSalaryChart([]);
                }
            },
            error: function (xhr) {
                console.error("AJAX Error:", xhr);
                if (typeof round_error_noti === 'function') {
                    round_error_noti(xhr.responseJSON?.responseMessage || 'An error occurred. Please try again.');
                } else {
                    alert('An error occurred. Please try again.');
                }
                // Render empty states
                processAndRenderCalculatedDays([]);
                processAndRenderSalaryChart([]);
            }
        });
    }

    function fetchYearlySalaryReport(EmployeeId) {
        var selectedYear = document.getElementById('yearSelector').value || '2025';

        var isValid = true;
        // Validate the selected year
        if (selectedYear === "" || selectedYear === null) {
            $("#spnyear").show();
            isValid = false;
        } else {
            $("#spnyear").hide();
        }
        if (!isValid) {
            return;
        }

        $.ajax({
            url: '@(baseDomainUrl + "/api/MonthlySalaryDetailsAPI/GetYearlySalaryCard")',
            type: 'GET',
            data: {
                year: parseInt(selectedYear),
                EmployeeId: EmployeeId
            },
            contentType: 'application/json',
            success: function (res) {
                console.log("res", res);
                if (res.isSuccess) {
                    renderTable(res.data);
                } else {
                    if (typeof round_error_noti === 'function') {
                        round_error_noti(res.responseMessage || 'No Data Found');
                    } else {
                        alert(res.responseMessage || 'No Data Found');
                    }
                    renderTable([]);
                }
            },
            error: function (xhr) {
                console.error("AJAX Error:", xhr);
                if (typeof round_error_noti === 'function') {
                    round_error_noti(xhr.responseJSON?.responseMessage || 'An error occurred. Please try again.');
                } else {
                    alert('An error occurred. Please try again.');
                }
                renderTable([]);
            }
        });
    }
</script>