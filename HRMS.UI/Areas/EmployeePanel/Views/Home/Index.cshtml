@{
    ViewData["Title"] = "Employee Panel";
    Layout = "~/Areas/EmployeePanel/Views/Shared/_EmployeeLayout.cshtml";
    string baseUrl = ViewBag.BaseUrl;
    string apiBase = ViewBag.BaseUrlAPI;
}

<style>
    .notification-list-container ul {
        max-height: 180px;
        overflow-y: auto;
        padding-left: 20px;
        margin: 0;
        border: 1px solid #ddd;
    }

    .card:hover {
        transform: scale(1.01);
        transition: 0.3s ease-in-out;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        cursor: pointer;
    }
</style>

<!-- Dashboard Heading -->
@* <div class="card mb-4 border-0 shadow-sm bg-light">
    <div class="card-body py-3">
        <div class="row align-items-center">
            <div class="col">
                <h5 class="text-primary mb-0">Dashboard</h5>
                
            </div>
        </div>
    </div>
</div> *@

<!-- Main Dashboard Cards -->
<div class="row row-cols-1 row-cols-md-2 row-cols-xl-4 g-4 essPenalSec">

    <div class="col">
        <div id="employeeid" class="card h-100 radius-10 border-start border-3 border-info">
            <div class="card-body d-flex align-items-center">
                <div>
                    <p class="my-1 text-info fs-4">Employee & Team</p>
                    <h6 class="mb-0 text-secondary">Explore your team detail from direct & in-direct reporting.</h6>
                </div>
                <div class="widgets-icons-2 rounded-circle bg-gradient-scooter text-white ms-auto">
                    <i class='bx bxs-group'></i>
                </div>
            </div>
        </div>
    </div>

    <div class="col">
        <div id="attendanceleaveid" class="card h-100 radius-10 border-start border-3 border-danger">
            <div class="card-body d-flex align-items-center">
                <div>
                    <p class="my-1 text-danger fs-4">Attendance & Leave</p>
                    <h6 class="mb-0 text-secondary">Daily or Monthly Attendance Details</h6>
                </div>
                <div class="widgets-icons-2 rounded-circle bg-gradient-bloody text-white ms-auto">
                    <i class='fadeIn animated bx bx-history'></i>
                </div>
            </div>
        </div>
    </div>

    <div class="col">
        <div id="salaryid" class="card h-100 radius-10 border-start border-3 border-warning">
            <div class="card-body d-flex align-items-center">
                <div>
                    <p class="my-1 text-warning fs-4">Salary</p>
                    <h6 class="mb-0 text-secondary">Check-out your processed and published salary detail.</h6>
                </div>
                <div class="widgets-icons-2 rounded-circle bg-gradient-blooker text-white ms-auto">
                    <i class='fadeIn animated bx bx-dollar'></i>
                </div>
            </div>
        </div>
    </div>

    <div class="col">
        <div id="reportid" class="card h-100 radius-10 border-start border-3 border-success">
            <div class="card-body d-flex align-items-center">
                <div>
                    <p class="my-1 text-success fs-4">Reports</p>
                    <h6 class="mb-0 text-secondary">Get the details of reports</h6>
                </div>
                <div class="widgets-icons-2 rounded-circle bg-gradient-ohhappiness text-white ms-auto">
                    <i class='fadeIn animated bx bx-line-chart-down'></i>
                </div>
            </div>
        </div>
    </div>
</div>

<br />

<!-- Latest Members & Wishes Section -->
<div class="row">
    <div class="col-md-3">
        <div id="latestmemberid" class="card custom-height radius-10 border-start border-0 border-3 border-info">
            <!-- Card Header -->
            <div class="card-header bg-warning text-dark">
                <h6 class="mb-0">Latest Members</h6>
                <span id="totalMemberCount" class="text-success"></span>
            </div>

            <div class="px-3 py-2">
                <div id="companyNameDisplay" class="text-primary"></div>
            </div>

            <!-- Scrollable Card Body -->
            <div class="card-body p-2" style="max-height: 260px; overflow-y: auto;" id="latestMembersContent">
                <p class="card-text">Loading members...</p>
            </div>
        </div>
    </div>


    <div class="col-md-6">
        <div class="card custom-height radius-10 border-start border-0 border-3 border-info">
            <div class="card-body">
                <ul class="nav nav-tabs" id="wishesid" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active" id="birthday-tab" data-toggle="tab" href="#birthdayid" role="tab">Birthday</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="workanniversary-tab" data-toggle="tab" href="#workanniversaryid" role="tab">Work Anniversary</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="anniversary-tab" data-toggle="tab" href="#anniversaryid" role="tab">Marriage Anniversary</a>
                    </li>
                </ul>

                <div class="tab-content mt-3" style="max-height: 260px; overflow-y: auto;">
                    <!-- Birthday -->
                    <div class="tab-pane fade show active" id="birthdayid" role="tabpanel">
                        <ul id="birthdayList" class="list-group list-group-flush">
                            <li class="list-group-item text-muted">Loading birthdays...</li>
                        </ul>
                    </div>

                    <!-- Work Anniversary -->
                    <div class="tab-pane fade" id="workanniversaryid" role="tabpanel">
                        <ul id="workAnniversaryList" class="list-group list-group-flush">
                            <li class="list-group-item text-muted">Loading work anniversaries...</li>
                        </ul>
                    </div>

                    <!-- Marriage Anniversary -->
                    <div class="tab-pane fade" id="anniversaryid" role="tabpanel">
                        <ul id="marriageAnniversaryList" class="list-group list-group-flush">
                            <li class="list-group-item text-muted">Loading marriage anniversaries...</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div class="col-md-3">
        <div class="card custom-height radius-10 border-start border-0 border-3 border-info">
            <div class="card-body">
                <ul class="nav flex-column nav-tabs" id="oganisationid" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active" id="holiday-tab" data-toggle="tab" href="#holidayid" role="tab">Upcoming Holiday</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="org-tab" data-toggle="tab" href="#orgid" role="tab">Organization Policy</a>
                    </li>
                </ul>

                <div class="tab-content mt-3">
                    <div class="tab-pane fade show active" id="holidayid" role="tabpanel">
                        <p class="card-text">Upcoming Holiday</p>
                    </div>
                    <div class="tab-pane fade" id="orgid" role="tabpanel">
                        <p class="card-text">Organization Policy</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<br />

<!-- Calendar and Fame Section -->
<div class="row">
    <div class="col-md-3">
        <div id="calenderid" class="card custom-height radius-10 border-start border-0 border-3 border-info">
            <div class="card-body">
                <div class="card-header bg-success text-dark">
                    <h6 class="mb-0">Event Calendar</h6>
                </div>
                <div class="card-body">
                    <p class="card-text">No records found.</p>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div id="fameid" class="card custom-height radius-10 border-start border-0 border-3 border-info">
            <div class="card-body">
                <div class="card-header text-dark" style="background-color: pink;">
                    <h6 class="mb-0">Wall Of Fame</h6>
                </div>
                <div class="card-body">
                    <p class="card-text">No records found.</p>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- Navigation Scripts -->
<script>
    document.getElementById("employeeid").addEventListener("click", function () {
        window.location.href = "@baseUrl/EmployeePanel/Home/EmployeeandTeam";
    });

    document.getElementById("attendanceleaveid").addEventListener("click", function () {
        window.location.href = "@baseUrl/EmployeePanel/Home/AttendanceLeave";
    });

    document.getElementById("salaryid").addEventListener("click", function () {
        window.location.href = "@baseUrl/EmployeePanel/Home/Salary";
    });

    document.getElementById("reportid").addEventListener("click", function () {
        window.location.href = "@baseUrl/EmployeePanel/Home/Reports";
    });
    const apiBase = '@apiBase';
    const savedCompany = localStorage.getItem('selectedCompany');
    const companyDetails = JSON.parse(savedCompany);
    const Compid = parseInt(companyDetails.CompanyId);

        $(document).ready(function () {
            loadLatestMembers();            
              loadBirthday();
              loadworkanniversary();
              loadanniversary();

        });

        $('#birthday-tab').on('click', function () {
         loadBirthday();
    });
        
    $('#workanniversary-tab').on('click', function () {
         loadworkanniversary();
    });

    $('#anniversary-tab').on('click', function () {
         loadanniversary();
    });
    function loadLatestMembers() {
         $('#companyNameDisplay').text(companyDetails.CompanyName);
        const apiUrl = `${apiBase}/EmployeeDashBoardAPI/GetRecentJoinedEmployees?Compid=${Compid}`;
       
        $.ajax({
            url: apiUrl,
            type: 'GET',
            success: function (response) {

                let html = '';

                // ✅ Correct: response.data should be the array
                const members = response.data;
              

                if (!Array.isArray(members) || members.length === 0) {
                    html = '<p class="card-text">No new members found.</p>';
                } else {
                    html += '<ul class="list-group">';
                    members.forEach(member => {
                        const imageUrl = member.employeeProfileUrl || '/images/default-user.png';
                     const joiningDate = member.dateOfJoining
                        ? formatDateToDDMMYYYY(member.dateOfJoining)
                        : '';

                        html += `
                            <li class="list-group-item d-flex align-items-center">
                                <img src="${imageUrl}" class="rounded-circle me-2" style="width: 40px; height: 40px; object-fit: cover;" alt="Profile" />
                                <div>
                                    <div><strong>${member.fullName}</strong></div>
                                    <div class="text-muted">${member.designationName ?? ''}</div>
                                    <small class="text-secondary">Joined: ${joiningDate}</small>
                                </div>
                            </li>`;
                    });
                    html += '</ul>';
                }

                $('#latestMembersContent').html(html);
            },
            error: function (xhr, status, error) {
                console.error("AJAX Error:", error);
                $('#latestmemberid .card-body:last').html('<p class="text-danger">Failed to load members.</p>');
            }
        });
    }

        function formatDateToDDMMYYYY(isoDate) {
        if (!isoDate) return '';

        const date = new Date(isoDate);
        const day = String(date.getDate()).padStart(2, '0');
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const year = date.getFullYear();

        return `${day}-${month}-${year}`;
    }

     function  loadBirthday() {
         $('#companyNameDisplay').text(companyDetails.CompanyName);
        const apiUrl = `${apiBase}/EmployeeDashBoardAPI/GetTodayBirthdaysByCompany?Compid=${Compid}`;
         
        $.ajax({
            url: apiUrl,
            type: 'GET',
            success: function (response) {

                let html = '';

                // ✅ Correct: response.data should be the array
                const members = response.data;
             
              

                if (!Array.isArray(members) || members.length === 0) {
                    html = '<p class="card-text">No new members found.</p>';
                } else {
                    html += '<ul class="list-group">';
                    members.forEach(member => {
                        const imageUrl = member.employeeProfileUrl || '/images/default-user.png';
                     const Bithdate = member.date
                        ? formatDateToDDMMYYYY(member.date)
                        : '';

                        html += `
                            <li class="list-group-item d-flex align-items-center">
                                <img src="${imageUrl}" class="rounded-circle me-2" style="width: 40px; height: 40px; object-fit: cover;" alt="Profile" />
                                <div>
                                    <div>Name:<strong>${member.fullName}</strong></div>
                                    <small">BithDate:${Bithdate}</small>
                                    <div>CompanyName:${member.companyName ?? ''}</div>
                                    <div>BranchName:${member.branchName ?? ''}</div>
                                    <div>Designation:${member.designationName ?? ''}</div>
                                    <div>Department:${member.departmentName ?? ''}</div>
                                    <div>Age:${member.ageInYears ?? ''}</div>
                                    
                                </div>
                            </li>`;
                    });
                    html += '</ul>';
                }

              $('#birthdayList').html(html);
            },
            error: function (xhr, status, error) {
                console.error("AJAX Error:", error);
                $('#latestmemberid .card-body:last').html('<p class="text-danger">Failed to load members.</p>');
            }
        });
    }


     function  loadworkanniversary() {
    
         $('#companyNameDisplay').text(companyDetails.CompanyName);
        const apiUrl = `${apiBase}/EmployeeDashBoardAPI/GetTodayWorkAnniversary?Compid=${Compid}`;
    
        $.ajax({
            url: apiUrl,
            type: 'GET',
            success: function (response) {
               

                let html = '';

                // ✅ Correct: response.data should be the array
                const members = response.data;
                


                if (!Array.isArray(members) || members.length === 0) {
                    html = '<p class="card-text">No new members found.</p>';
                } else {
                    html += '<ul class="list-group">';
                    members.forEach(member => {
                        const imageUrl = member.employeeProfileUrl || '/images/default-user.png';
                     const date = member.date
                        ? formatDateToDDMMYYYY(member.date)
                        : '';

                        html += `
                            <li class="list-group-item d-flex align-items-center">
                                <img src="${imageUrl}" class="rounded-circle me-2" style="width: 40px; height: 40px; object-fit: cover;" alt="Profile" />
                                <div>
                                    <div>Name:<strong>${member.fullName}</strong></div>
                                    <small">JoiningDate:${date}</small>
                                    <div>CompanyName:${member.companyName ?? ''}</div>
                                    <div>BranchName:${member.branchName ?? ''}</div>
                                    <div>Designation:${member.designationName ?? ''}</div>
                                    <div>Department:${member.departmentName ?? ''}</div>
                                    <div>TotalYears:${member.ageInYears ?? ''}</div>

                                </div>
                            </li>`;
                    });
                    html += '</ul>';
                }

              $('#workAnniversaryList').html(html);
            },
            error: function (xhr, status, error) {
                console.error("AJAX Error:", error);
                $('#latestmemberid .card-body:last').html('<p class="text-danger">Failed to load members.</p>');
            }
        });
    }


      function  loadanniversary() {
         $('#companyNameDisplay').text(companyDetails.CompanyName);
        const apiUrl = `${apiBase}/EmployeeDashBoardAPI/GetTodayMarriageAnnivarsary?Compid=${Compid}`;
        
        $.ajax({
            url: apiUrl,
            type: 'GET',
            success: function (response) {

                let html = '';

                // ✅ Correct: response.data should be the array
                const members = response.data;
         

                if (!Array.isArray(members) || members.length === 0) {
                    html = '<p class="card-text">No new members found.</p>';
                } else {
                    html += '<ul class="list-group">';
                    members.forEach(member => {
                        const imageUrl = member.employeeProfileUrl || '/images/default-user.png';
                     const date = member.date
                        ? formatDateToDDMMYYYY(member.date)
                        : '';

                        html += `
                            <li class="list-group-item d-flex align-items-center">
                                <img src="${imageUrl}" class="rounded-circle me-2" style="width: 40px; height: 40px; object-fit: cover;" alt="Profile" />
                                <div>
                                    <div>Name:<strong>${member.fullName}</strong></div>
                                    <small">MarriageDate:${date}</small>
                                    <div>CompanyName:${member.companyName ?? ''}</div>
                                    <div>BranchName:${member.branchName ?? ''}</div>
                                    <div>Designation:${member.designationName ?? ''}</div>
                                    <div>Department:${member.departmentName ?? ''}</div>

                                </div>
                            </li>`;
                    });
                    html += '</ul>';
                }

              $('#marriageAnniversaryList').html(html);
            },
            error: function (xhr, status, error) {
                console.error("AJAX Error:", error);
                $('#latestmemberid .card-body:last').html('<p class="text-danger">Failed to load members.</p>');
            }
        });
    }

</script>
