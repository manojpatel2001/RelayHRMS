name: Update Azure Branch from Development

on:
  push:
    branches:
      - development
  workflow_dispatch:

jobs:
  update-azure-branch:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}
          
      - name: Configure Git
        run: |
          git config user.name "HRMS Development Team"
          git config user.email "dev@hrmsproject.com"
          
      - name: Update Azure Branch
        run: |
          # Fetch all branches
          git fetch origin
          
          # Checkout development
          git checkout development
          
          # Check if azure branch exists remotely
          if git ls-remote --heads origin azure | grep azure; then
            echo "Azure branch exists, checking out..."
            git checkout azure
            git pull origin azure
          else
            echo "Azure branch doesn't exist, creating..."
            git checkout -b azure
          fi
          
          # Merge development into azure
          git merge development --no-ff -m "Auto sync from development - $(date +'%d-%m-%Y %H:%M')"
          
          # Push to GitHub
          git push origin azure
