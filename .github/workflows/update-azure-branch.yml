name: Sync Development to Azure

on:
  push:
    branches:
      - development
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest
    
    steps:
      # Step 1: Checkout development branch
      - name: Checkout development branch
        uses: actions/checkout@v4
        with:
          ref: development
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}
          
      - name: Setup Git Config
        run: |
          git config user.name "HRMS Bot"
          git config user.email "hrms-bot@noreply.github.com"
          
      # Step 2: Fetch all remote branches
      - name: Fetch all branches
        run: |
          git fetch origin
          
      # Step 3: Switch to or create azure branch
      - name: Switch to azure branch
        run: |
          # Check if azure exists remotely
          if git show-ref --verify --quiet refs/remotes/origin/azure; then
            echo "Azure branch exists, checking out..."
            git checkout -B azure origin/azure
          else
            echo "Azure branch doesn't exist, creating..."
            git checkout -b azure
          fi
          
      # Step 4: Reset azure to match development
      - name: Sync azure with development
        run: |
          # Reset azure branch to match development exactly
          git reset --hard origin/development
          
      # Step 5: Push to remote
      - name: Push azure branch
        run: |
          git push origin azure --force
          
      # Step 6: Verify
      - name: Verify sync
        run: |
          echo "âœ… Azure branch successfully synced with development"
          echo "Latest commit:"
          git log -1 --pretty=format:"%h - %s (%an, %ar)"
